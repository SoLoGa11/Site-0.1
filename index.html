<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TbilisiPrice ‚Äî –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080C14;--bg1:#0D1320;--bg2:#111827;--bg3:#1A2235;
  --text:#F0F4FF;--text2:#8B9AB5;--text3:#4B5A72;
  --accent:#4F7BFF;--accent2:#7C9FFF;
  --ag:rgba(79,123,255,0.18);--ag2:rgba(79,123,255,0.07);
  --green:#22C55E;--gbg:rgba(34,197,94,0.1);
  --orange:#F59E0B;--obg:rgba(245,158,11,0.1);
  --red:#F43F5E;--rbg:rgba(244,63,94,0.09);
  --border:rgba(255,255,255,0.07);
  --sh:0 2px 12px rgba(0,0,0,.45);
  --sh2:0 8px 40px rgba(0,0,0,.65);
  --r:14px;--r2:10px;--r3:20px;
}
[data-theme="light"]{
  --bg:#EEF2FF;--bg1:#fff;--bg2:#F5F7FF;--bg3:#E8EDFF;
  --text:#0A0F1E;--text2:#4B5A72;--text3:#94A3B8;
  --accent:#3B5BDB;--accent2:#4F6EE8;
  --ag:rgba(59,91,219,0.12);--ag2:rgba(59,91,219,0.05);
  --border:rgba(0,0,0,0.08);
  --sh:0 2px 12px rgba(0,0,0,.08);
  --sh2:0 8px 40px rgba(0,0,0,.14);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased;transition:background .35s,color .35s;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.025'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:.6}
.amb{position:fixed;border-radius:50%;filter:blur(110px);pointer-events:none;z-index:0}
.amb1{width:550px;height:350px;background:rgba(79,123,255,.055);top:-80px;left:-80px}
.amb2{width:380px;height:380px;background:rgba(124,159,255,.035);bottom:15%;right:-40px}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
header{position:sticky;top:0;z-index:200;border-bottom:1px solid var(--border);padding:0 28px;backdrop-filter:blur(22px) saturate(1.5);-webkit-backdrop-filter:blur(22px) saturate(1.5)}
[data-theme="dark"] header{background:rgba(8,12,20,.86)}
[data-theme="light"] header{background:rgba(238,242,255,.9)}
.hr1{display:flex;align-items:center;gap:18px;height:62px}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0;min-width:148px}
.lmark{width:34px;height:34px;background:var(--accent);border-radius:10px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 0 1px rgba(79,123,255,.5),0 4px 14px rgba(79,123,255,.3);font-size:16px;font-weight:900;color:#fff;letter-spacing:-1px}
.ltxt{font-size:16px;font-weight:800;color:var(--text);letter-spacing:-.5px}
.ltxt em{font-style:normal;color:var(--accent)}
.sbox{flex:1;max-width:620px;position:relative}
.sinp{width:100%;height:42px;background:var(--bg2);border:1.5px solid var(--border);border-radius:100px;padding:0 44px;font-family:inherit;font-size:14px;font-weight:500;color:var(--text);outline:none;transition:border-color .2s,box-shadow .2s,background .2s}
.sinp::placeholder{color:var(--text3);font-weight:400}
.sinp:focus{border-color:var(--accent);background:var(--bg1);box-shadow:0 0 0 3px var(--ag)}
.sico{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text3);pointer-events:none}
.sclear{position:absolute;right:12px;top:50%;transform:translateY(-50%);width:22px;height:22px;border:none;background:var(--bg3);border-radius:50%;cursor:pointer;color:var(--text3);font-size:13px;display:none;align-items:center;justify-content:center;transition:all .15s}
.sclear:hover{background:var(--rbg);color:var(--red)}
.sinp:not(:placeholder-shown) ~ .sclear{display:flex}
.hacts{display:flex;align-items:center;gap:6px;flex-shrink:0}
.hbtn{width:36px;height:36px;background:var(--bg2);border:1px solid var(--border);border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text2);transition:all .15s;position:relative}
.hbtn:hover,.hbtn.on{border-color:var(--accent);color:var(--accent);background:var(--ag2)}
.nbadge{position:absolute;top:-4px;right:-4px;width:14px;height:14px;background:var(--red);border-radius:50%;font-size:8px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;border:2px solid var(--bg)}
.avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#4F7BFF,#818CF8);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;color:#fff;border:2px solid var(--border);cursor:pointer;transition:transform .15s,box-shadow .15s}
.avatar:hover{transform:scale(1.05);box-shadow:0 0 0 3px var(--ag)}
.chips{display:flex;gap:5px;padding:9px 0 11px;margin-left:44px;overflow-x:auto}
.chips::-webkit-scrollbar{display:none}
.chip{height:26px;padding:0 12px;border-radius:100px;border:1px solid var(--border);background:transparent;font-family:inherit;font-size:11.5px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;white-space:nowrap}
.chip:hover{border-color:var(--accent);color:var(--accent);background:var(--ag2)}
.chip.active{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(79,123,255,.3)}

/* ‚ïê‚ïê DROPDOWN PANELS ‚ïê‚ïê */
.dpanel{position:absolute;top:calc(100% + 8px);background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);box-shadow:var(--sh2);z-index:400;display:none;animation:dpop .18s ease}
.dpanel.open{display:block}
@keyframes dpop{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:none}}
/* Notifications */
.dpanel-notif{right:0;width:340px;padding:0}
.dpn-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--border)}
.dpn-title{font-size:14px;font-weight:800}
.dpn-mark{font-size:11px;font-weight:700;color:var(--accent);cursor:pointer;background:none;border:none;font-family:inherit}
.notif-list{max-height:340px;overflow-y:auto}
.notif-item{display:flex;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s}
.notif-item:hover{background:var(--bg2)}
.notif-item.unread{background:var(--ag2)}
.ni-dot{width:7px;height:7px;border-radius:50%;background:var(--accent);margin-top:5px;flex-shrink:0}
.ni-dot.read{background:transparent;border:1.5px solid var(--text3)}
.ni-body{flex:1}
.ni-title{font-size:13px;font-weight:700;margin-bottom:2px}
.ni-sub{font-size:11.5px;color:var(--text2);line-height:1.4}
.ni-time{font-size:10px;color:var(--text3);margin-top:3px;font-family:'DM Mono',monospace}
/* Favorites */
.dpanel-fav{right:0;width:360px;padding:0}
.dpf-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--border)}
.fav-list{max-height:380px;overflow-y:auto;padding:8px}
.fav-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:var(--r2);cursor:pointer;transition:background .15s;border:1px solid transparent}
.fav-item:hover{background:var(--bg2);border-color:var(--border)}
.fav-thumb{width:40px;height:40px;border-radius:9px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.fav-name{font-size:13px;font-weight:700;flex:1}
.fav-price{font-size:13px;font-weight:800;color:var(--accent);font-family:'DM Mono',monospace;white-space:nowrap}
.fav-remove{width:24px;height:24px;background:none;border:none;cursor:pointer;color:var(--text3);font-size:14px;display:flex;align-items:center;justify-content:center;border-radius:6px;transition:all .15s;flex-shrink:0}
.fav-remove:hover{background:var(--rbg);color:var(--red)}
.dpf-empty{padding:32px;text-align:center;color:var(--text3);font-size:13px}
/* Profile */
.dpanel-profile{right:0;width:240px;padding:0;overflow:hidden}
.prof-head{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.prof-av{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#4F7BFF,#818CF8);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:14px}
.prof-name{font-size:14px;font-weight:800}
.prof-email{font-size:11px;color:var(--text3)}
.prof-menu-item{display:flex;align-items:center;gap:10px;padding:11px 16px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;border:none;background:none;font-family:inherit;width:100%;text-align:left}
.prof-menu-item:hover{background:var(--bg2);color:var(--text)}
.prof-menu-item.danger:hover{background:var(--rbg);color:var(--red)}
.prof-divider{height:1px;background:var(--border);margin:4px 0}

/* ‚ïê‚ïê LAYOUT ‚ïê‚ïê */
.layout{display:grid;grid-template-columns:0px 1fr 0px;gap:0;max-width:1600px;margin:0 auto;padding:20px 28px;align-items:start;transition:grid-template-columns .35s cubic-bezier(.4,0,.2,1),gap .35s;position:relative;z-index:1}
.layout.fo{grid-template-columns:288px 1fr 0px;gap:20px}
.layout.ao{grid-template-columns:0px 1fr 368px;gap:20px}
.layout.fao{grid-template-columns:288px 1fr 368px;gap:20px}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
.sidebar{overflow:hidden;opacity:0;transform:translateX(-10px);transition:opacity .3s,transform .3s;pointer-events:none}
.fo .sidebar,.fao .sidebar{opacity:1;transform:none;pointer-events:all}
.sc{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);padding:20px;box-shadow:var(--sh);position:sticky;top:108px;min-width:268px}
.slab{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:14px}
.fg{margin-bottom:18px}
.fl{font-size:12px;font-weight:600;color:var(--text2);margin-bottom:8px;display:block}
.rrow{display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:11px;color:var(--text3);margin-bottom:7px}
.rv{color:var(--accent);font-weight:500}
input[type=range]{width:100%;-webkit-appearance:none;height:3px;border-radius:2px;background:var(--bg3);outline:none;cursor:pointer;accent-color:var(--accent)}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:15px;height:15px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 0 3px var(--ag);transition:transform .15s}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2)}
.bgrid{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.bi{display:flex;align-items:center;gap:7px;padding:7px 9px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);cursor:pointer;transition:all .15s;user-select:none}
.bi:hover{border-color:var(--accent);background:var(--ag2)}
.bi.on{border-color:var(--accent);background:var(--ag)}
.bcb{width:14px;height:14px;border:1.5px solid var(--border);border-radius:4px;flex-shrink:0;transition:all .15s;display:flex;align-items:center;justify-content:center}
.bi.on .bcb{background:var(--accent);border-color:var(--accent)}
.bi.on .bcb::after{content:'‚úì';color:#fff;font-size:9px;font-weight:800}
.bn{font-size:12px;font-weight:600;color:var(--text2)}
.trow{display:flex;align-items:center;justify-content:space-between;padding:7px 0;cursor:pointer}
.trow span{font-size:13px;font-weight:500;color:var(--text)}
.tog{width:34px;height:18px;background:var(--bg3);border-radius:100px;position:relative;border:none;cursor:pointer;transition:background .2s;flex-shrink:0}
.tog.on{background:var(--accent)}
.tog::after{content:'';position:absolute;width:12px;height:12px;background:#fff;border-radius:50%;top:3px;left:3px;transition:left .2s;box-shadow:0 1px 3px rgba(0,0,0,.3)}
.tog.on::after{left:19px}
.ssel{display:flex;gap:3px}
.sbtn{width:30px;height:26px;border:1px solid var(--border);background:var(--bg2);border-radius:7px;cursor:pointer;font-size:13px;transition:all .15s;display:flex;align-items:center;justify-content:center}
.sbtn.on{background:rgba(245,158,11,.15);border-color:var(--orange)}
.arow{display:flex;gap:8px;margin-top:4px;padding-top:14px;border-top:1px solid var(--border)}
.bfill{flex:1;height:36px;background:var(--accent);color:#fff;border:none;border-radius:var(--r2);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:background .15s,transform .1s;box-shadow:0 4px 14px rgba(79,123,255,.25)}
.bfill:hover{background:var(--accent2)}
.bfill:active{transform:scale(.98)}
.bghost{height:36px;padding:0 14px;background:transparent;border:1px solid var(--border);border-radius:var(--r2);font-family:inherit;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s}
.bghost:hover{border-color:var(--text2);color:var(--text)}

/* ‚ïê‚ïê CONTENT ‚ïê‚ïê */
.content{min-width:0}
.vtabs{display:flex;gap:3px;background:var(--bg2);padding:3px;border-radius:var(--r2);border:1px solid var(--border)}
.vtab{flex:1;height:30px;background:transparent;border:none;border-radius:8px;font-family:inherit;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:5px}
.vtab.active{background:var(--bg1);color:var(--text);box-shadow:var(--sh)}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;flex-wrap:wrap}
.trow2{display:flex;align-items:center;gap:10px}
.ptitle{font-size:19px;font-weight:800;letter-spacing:-.5px}
.cpill{font-size:11px;font-weight:700;color:var(--text3);background:var(--bg2);border:1px solid var(--border);padding:2px 9px;border-radius:100px;font-family:'DM Mono',monospace}
.fbtn{display:flex;align-items:center;gap:5px;height:32px;padding:0 12px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);font-family:inherit;font-size:11px;font-weight:700;color:var(--text2);cursor:pointer;transition:all .15s;text-transform:uppercase;letter-spacing:.5px}
.fbtn.active,.fbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--ag2)}
.srow{display:flex;gap:3px}
.srtbtn{height:30px;padding:0 12px;background:transparent;border:1px solid var(--border);border-radius:100px;font-family:inherit;font-size:11.5px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;white-space:nowrap}
.srtbtn:hover{border-color:var(--accent);color:var(--accent)}
.srtbtn.active{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(79,123,255,.25)}
.fresh{display:flex;align-items:center;gap:10px;padding:10px 14px;background:linear-gradient(90deg,rgba(79,123,255,.06),rgba(79,123,255,.02));border:1px solid rgba(79,123,255,.15);border-radius:var(--r2);margin-bottom:14px;font-size:12px;font-weight:600;color:var(--accent2)}
.fdot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 2s infinite;flex-shrink:0}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.sep{color:var(--text3)}
.altbtn{margin-left:auto;height:24px;padding:0 10px;background:rgba(79,123,255,.12);border:1px solid rgba(79,123,255,.2);border-radius:100px;font-family:inherit;font-size:11px;font-weight:700;color:var(--accent);cursor:pointer;transition:all .15s}
.altbtn:hover{background:rgba(79,123,255,.22)}

/* ‚ïê‚ïê CARDS ‚ïê‚ïê */
.clist{display:flex;flex-direction:column;gap:10px;transition:all .3s}
.pcard{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);padding:16px 18px;display:flex;align-items:center;gap:14px;box-shadow:var(--sh);transition:box-shadow .2s,border-color .2s,transform .15s,opacity .3s;cursor:pointer;position:relative;overflow:hidden}
.pcard::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:transparent;transition:background .2s;border-radius:2px 0 0 2px}
.pcard:hover{box-shadow:var(--sh2);border-color:rgba(79,123,255,.25);transform:translateY(-1px)}
.pcard:hover::before{background:var(--accent)}
.pcard.best::before{background:var(--green)}
.pcard.best{border-color:rgba(34,197,94,.15)}
.pcard.hidden{display:none}
.thumb{width:64px;height:64px;flex-shrink:0;border-radius:12px;overflow:hidden;background:var(--bg2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:28px;position:relative}
.bbadge{position:absolute;top:-1px;right:-1px;background:var(--green);color:#fff;font-size:8px;font-weight:800;padding:2px 5px;border-radius:0 0 0 6px;letter-spacing:.3px}
.cbody{flex:1;min-width:0}
.cname{font-size:14.5px;font-weight:700;color:var(--text);letter-spacing:-.2px;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.csub{font-size:11.5px;color:var(--text2);font-weight:500;margin-bottom:7px;display:flex;align-items:center;gap:8px}
.crat{display:flex;align-items:center;gap:3px}
.ss{color:var(--orange);font-size:10px;letter-spacing:-1px}
.rv2{font-family:'DM Mono',monospace;font-size:11px}
.ctags{display:flex;gap:5px;flex-wrap:wrap}
.tag{height:18px;padding:0 8px;border-radius:100px;font-size:10px;font-weight:700;display:flex;align-items:center;letter-spacing:.2px;white-space:nowrap}
.tg{background:var(--gbg);color:var(--green)}
.to{background:var(--obg);color:var(--orange)}
.tb{background:var(--ag);color:var(--accent2)}
.tr{background:var(--rbg);color:var(--red)}
.cright{display:flex;flex-direction:column;align-items:flex-end;gap:10px;flex-shrink:0;min-width:148px}
.pmain{font-size:22px;font-weight:800;color:var(--accent);letter-spacing:-.5px;line-height:1}
.pold{font-size:12px;color:var(--text3);text-decoration:line-through;font-family:'DM Mono',monospace;margin-top:2px}
.pdiff{font-size:10px;color:var(--green);font-weight:700}
.cbtns{display:flex;gap:5px;align-items:center}
.bgo{height:30px;padding:0 14px;background:var(--accent);color:#fff;border:none;border-radius:var(--r2);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:background .15s;white-space:nowrap;box-shadow:0 2px 8px rgba(79,123,255,.25)}
.bgo:hover{background:var(--accent2)}
.bout{height:30px;padding:0 12px;background:transparent;border:1.5px solid var(--border);border-radius:var(--r2);font-family:inherit;font-size:12px;font-weight:700;color:var(--text2);cursor:pointer;transition:all .15s;white-space:nowrap}
.bout:hover{border-color:var(--accent);color:var(--accent)}
.bout.cmp-on{border-color:var(--accent);color:var(--accent);background:var(--ag2)}
.fav{width:30px;height:30px;background:transparent;border:1.5px solid var(--border);border-radius:var(--r2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--text3);transition:all .15s}
.fav:hover,.fav.on{border-color:var(--red);color:var(--red);background:var(--rbg)}

/* No results */
.nores{display:none;flex-direction:column;align-items:center;justify-content:center;padding:60px 24px;text-align:center;gap:14px}
.nores.show{display:flex}
.nores-ico{font-size:48px}
.nores-t{font-size:17px;font-weight:800}
.nores-s{font-size:13px;color:var(--text2);max-width:260px}

/* ‚ïê‚ïê COMPARE BAR ‚ïê‚ïê */
.cmpbar{position:fixed;bottom:0;left:0;right:0;background:var(--bg1);border-top:1px solid var(--border);padding:12px 28px;display:none;align-items:center;gap:14px;z-index:300;box-shadow:0 -8px 32px rgba(0,0,0,.4);transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1)}
.cmpbar.vis{display:flex;transform:translateY(0)}
.cmp-slots{display:flex;gap:10px;flex:1}
.cslot{min-width:150px;height:46px;border:1.5px dashed var(--border);border-radius:var(--r2);display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--text3);font-weight:600;padding:0 10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cslot.fill{border-style:solid;border-color:var(--accent);background:var(--ag2);color:var(--text);font-size:12px;font-weight:700;justify-content:flex-start}
.cmp-go{height:40px;padding:0 22px;background:var(--accent);color:#fff;border:none;border-radius:var(--r2);font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:background .15s;box-shadow:0 2px 10px rgba(79,123,255,.3)}
.cmp-go:hover{background:var(--accent2)}
.cmp-x{width:32px;height:32px;background:transparent;border:1px solid var(--border);border-radius:var(--r2);cursor:pointer;color:var(--text2);font-size:18px;display:flex;align-items:center;justify-content:center;transition:all .15s}
.cmp-x:hover{border-color:var(--red);color:var(--red);background:var(--rbg)}

/* ‚ïê‚ïê MAP ‚ïê‚ïê */
.mapview{display:none}
.mapview.active{display:block}
.mapc{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);overflow:hidden;height:520px;position:relative}
.mppanel{position:absolute;right:0;top:0;bottom:0;width:272px;background:rgba(8,12,20,.92);backdrop-filter:blur(12px);border-left:1px solid var(--border);display:flex;flex-direction:column;z-index:10}
[data-theme="light"] .mppanel{background:rgba(238,242,255,.94)}
.mphdr{padding:14px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:700}
.mphdr span{color:var(--text2);font-weight:500;font-size:12px;margin-left:5px}
.slist{flex:1;overflow-y:auto;padding:7px}
.si{padding:10px 11px;border-radius:var(--r2);cursor:pointer;transition:all .15s;margin-bottom:3px;border:1px solid transparent}
.si:hover{background:var(--bg2);border-color:var(--border)}
.si.active{background:var(--ag);border-color:rgba(79,123,255,.25)}
.si-name{font-size:13px;font-weight:700}
.si-sub{font-size:11px;color:var(--text2);margin-top:2px}
.si-sub span{color:var(--green);font-weight:600}
.sdot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:5px;vertical-align:middle}
/* Store popup on map */
.map-popup{position:absolute;background:var(--bg1);border:1px solid var(--border);border-radius:var(--r2);padding:10px 13px;font-size:12px;box-shadow:var(--sh2);pointer-events:none;z-index:20;display:none;min-width:160px}
.map-popup.show{display:block}
.map-pin{cursor:pointer;transition:all .2s;filter:drop-shadow(0 2px 5px rgba(0,0,0,.4))}
.map-pin:hover{filter:drop-shadow(0 4px 10px rgba(79,123,255,.5))}
.map-pin.active{filter:drop-shadow(0 0 12px rgba(79,123,255,.8))}

/* ‚ïê‚ïê AI DOCK ‚ïê‚ïê */
.aidock{overflow:hidden;opacity:0;transform:translateX(10px);transition:opacity .3s,transform .3s;pointer-events:none}
.ao .aidock,.fao .aidock{opacity:1;transform:none;pointer-events:all}
.aiinner{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);box-shadow:var(--sh2);position:sticky;top:108px;display:flex;flex-direction:column;min-width:348px;max-height:calc(100vh - 132px);overflow:hidden}
.lumhdr{padding:16px 18px 12px;border-bottom:1px solid var(--border);background:linear-gradient(135deg,rgba(79,123,255,.06),rgba(124,159,255,.03));display:flex;align-items:center;gap:12px}
.lumorb{width:38px;height:38px;border-radius:50%;flex-shrink:0;background:conic-gradient(from 0deg,#4F7BFF,#7C9FFF,#818CF8,#4F7BFF);display:flex;align-items:center;justify-content:center;animation:ospin 8s linear infinite;box-shadow:0 0 20px rgba(79,123,255,.35);position:relative}
.lumorb::before{content:'';position:absolute;inset:3px;border-radius:50%;background:var(--bg1)}
.lumorb::after{content:'L';position:absolute;font-size:14px;font-weight:900;color:var(--accent);z-index:1}
@keyframes ospin{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}
.lum-name{font-size:15px;font-weight:900;letter-spacing:-.3px}
.lum-name span{color:var(--accent)}
.lum-stat{font-size:11px;color:var(--text3);font-weight:500;display:flex;align-items:center;gap:5px;margin-top:2px}
.lsdot{width:5px;height:5px;border-radius:50%;background:var(--green);animation:blink 2s infinite}
.lcls{margin-left:auto;width:28px;height:28px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;cursor:pointer;color:var(--text2);font-size:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.lcls:hover{color:var(--text);background:var(--bg3)}
.linst{padding:10px 14px;border-bottom:1px solid var(--border);background:linear-gradient(90deg,rgba(79,123,255,.05),transparent);display:flex;align-items:flex-start;gap:8px}
.inst-ico{font-size:14px;flex-shrink:0;margin-top:1px}
.inst-t{font-size:12px;color:var(--text2);line-height:1.5;font-weight:500}
.inst-t strong{color:var(--accent2)}
.qwrap{padding:10px 12px;border-bottom:1px solid var(--border);display:flex;flex-direction:column;gap:5px}
.qbtn{display:flex;align-items:center;gap:8px;padding:8px 11px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);font-family:inherit;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;text-align:left}
.qbtn:hover{border-color:var(--accent);color:var(--text);background:var(--ag2)}
.qi{width:22px;height:22px;border-radius:6px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.msgs{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px;scrollbar-width:thin;scrollbar-color:var(--border) transparent}
.msg{display:flex;gap:8px;animation:min .25s ease}
.msg.u{flex-direction:row-reverse}
@keyframes min{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.mav{width:26px;height:26px;border-radius:50%;background:var(--bg3);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}
.msg.u .mav{background:linear-gradient(135deg,var(--accent),#818CF8);color:#fff;border:none}
.mbub{max-width:82%;padding:9px 12px;border-radius:var(--r3);font-size:13px;line-height:1.55;font-weight:500}
.msg.ai .mbub{background:var(--bg2);border:1px solid var(--border);color:var(--text);border-bottom-left-radius:4px}
.msg.u .mbub{background:var(--accent);color:#fff;border-bottom-right-radius:4px}
.mbub .ah{color:var(--accent2);font-weight:700}
.mbub .ph{font-family:'DM Mono',monospace;font-weight:700;color:var(--green)}
.mtime{font-size:10px;color:var(--text3);margin-top:4px;display:block}
.msg.u .mtime{text-align:right}
.dots{display:flex;gap:3px;align-items:center;padding:1px 0}
.dots span{width:5px;height:5px;border-radius:50%;background:var(--text3);animation:bounce 1.2s infinite}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,60%,100%{opacity:.3;transform:none}30%{opacity:1;transform:translateY(-3px)}}
.cirow{padding:10px 12px;border-top:1px solid var(--border);display:flex;gap:8px;align-items:center;background:var(--bg1)}
.cinp{flex:1;height:36px;background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);padding:0 12px;font-family:inherit;font-size:13px;font-weight:500;color:var(--text);outline:none;transition:all .15s}
.cinp::placeholder{color:var(--text3);font-weight:400}
.cinp:focus{border-color:var(--accent);box-shadow:0 0 0 2px var(--ag)}
.csnd{width:36px;height:36px;background:var(--accent);border:none;border-radius:var(--r2);cursor:pointer;color:#fff;display:flex;align-items:center;justify-content:center;transition:background .15s,transform .1s;box-shadow:0 2px 8px rgba(79,123,255,.3);flex-shrink:0}
.csnd:hover{background:var(--accent2)}
.csnd:active{transform:scale(.95)}

/* ‚ïê‚ïê LUMEN FAB ‚ïê‚ïê */
.lfab{position:fixed;bottom:24px;right:24px;z-index:201;width:54px;height:54px;border-radius:50%;background:conic-gradient(from 0deg,#4F7BFF,#7C9FFF,#818CF8,#4F7BFF);border:none;cursor:pointer;color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 28px rgba(79,123,255,.45),0 0 0 1px rgba(79,123,255,.3);animation:fp 3s ease-in-out infinite,fspin 12s linear infinite;transition:transform .2s}
.lfab::before{content:'';position:absolute;inset:3px;border-radius:50%;background:var(--bg)}
.lfabl{position:relative;z-index:1;font-size:18px;font-weight:900;color:var(--accent)}
@keyframes fp{0%,100%{box-shadow:0 8px 28px rgba(79,123,255,.45),0 0 0 1px rgba(79,123,255,.3)}50%{box-shadow:0 8px 36px rgba(79,123,255,.65),0 0 0 7px rgba(79,123,255,.09)}}
@keyframes fspin{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}
.lfab:hover{transform:scale(1.08)}
.flabl{position:absolute;right:62px;top:50%;transform:translateY(-50%);background:var(--bg1);border:1px solid var(--border);padding:5px 12px;border-radius:var(--r2);font-size:12px;font-weight:700;white-space:nowrap;box-shadow:var(--sh);opacity:0;pointer-events:none;transition:opacity .2s;color:var(--text)}
.lfab:hover .flabl{opacity:1}

/* ‚ïê‚ïê MODALS ‚ïê‚ïê */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);backdrop-filter:blur(5px);z-index:500;display:none;align-items:center;justify-content:center}
.overlay.open{display:flex}
.modal{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);padding:28px;box-shadow:var(--sh2);animation:min2 .2s ease;width:90%}
@keyframes min2{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:none}}
.mhdr{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px}
.mtitle{font-size:17px;font-weight:800;letter-spacing:-.3px}
.msub{font-size:12px;color:var(--text2);margin-top:3px}
.mcls{width:30px;height:30px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;cursor:pointer;color:var(--text2);font-size:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.mcls:hover{background:var(--rbg);color:var(--red)}
.chart-area{height:140px;margin-bottom:16px}
.pstats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.sbox{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:12px;text-align:center}
.sval{font-size:18px;font-weight:800;color:var(--accent);font-family:'DM Mono',monospace}
.slbl{font-size:10px;color:var(--text3);font-weight:600;margin-top:3px;text-transform:uppercase;letter-spacing:.5px}
.alrow{display:flex;align-items:center;justify-content:space-between;margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}
.allbl{font-size:13px;font-weight:600}
.alsub{font-size:11px;color:var(--text2);margin-top:2px}

/* Compare modal */
.cmp-modal{max-width:780px}
.cmp-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:4px}
.cmp-col{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:14px;display:flex;flex-direction:column;gap:8px}
.cmp-col.best-col{border-color:rgba(34,197,94,.3);background:rgba(34,197,94,.04)}
.cmp-prod{font-size:12px;font-weight:800;color:var(--text);line-height:1.35;margin-bottom:4px}
.cmp-store{font-size:11px;color:var(--text2);font-weight:500}
.cmp-price{font-size:20px;font-weight:800;color:var(--accent);font-family:'DM Mono',monospace}
.cmp-row{display:flex;justify-content:space-between;align-items:center;font-size:12px;padding:5px 0;border-bottom:1px solid var(--border)}
.cmp-row:last-child{border:none}
.cmp-row-k{color:var(--text3);font-weight:600}
.cmp-row-v{font-weight:700;color:var(--text)}
.cmp-best-badge{font-size:9px;font-weight:800;background:var(--green);color:#fff;padding:2px 7px;border-radius:100px;letter-spacing:.3px}

/* Profile modal */
.prof-modal{max-width:420px}
.prof-info{display:flex;align-items:center;gap:14px;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--border)}
.prof-av2{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#4F7BFF,#818CF8);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:20px}
.prof-n{font-size:17px;font-weight:800;letter-spacing:-.3px}
.prof-e{font-size:12px;color:var(--text2)}
.prof-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.pst{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:12px;text-align:center}
.pst-v{font-size:18px;font-weight:800;color:var(--accent);font-family:'DM Mono',monospace}
.pst-l{font-size:10px;color:var(--text3);font-weight:600;margin-top:2px;text-transform:uppercase;letter-spacing:.5px}

/* Store modal */
.store-modal{max-width:460px}
.store-modal .si-goods{display:flex;flex-direction:column;gap:7px;margin-top:14px;max-height:280px;overflow-y:auto}
.sg-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2)}
.sg-name{font-size:13px;font-weight:700}
.sg-price{font-size:14px;font-weight:800;color:var(--accent);font-family:'DM Mono',monospace}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
.toast-stack{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:600;display:flex;flex-direction:column;gap:8px;align-items:center;pointer-events:none}
.toast{background:var(--bg1);border:1px solid var(--border);border-radius:100px;padding:9px 18px;font-size:13px;font-weight:700;color:var(--text);box-shadow:var(--sh2);display:flex;align-items:center;gap:8px;white-space:nowrap;animation:toastin .3s ease,toastout .4s ease 2.2s forwards}
@keyframes toastin{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes toastout{from{opacity:1;transform:none}to{opacity:0;transform:translateY(-6px)}}
.toast.success .ti{color:var(--green)}
.toast.error .ti{color:var(--red)}
.toast.info .ti{color:var(--accent)}

::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
</style>
</head>
<body>
<div class="amb amb1"></div>
<div class="amb amb2"></div>

<!-- ‚ïê‚ïê HEADER ‚ïê‚ïê -->
<header>
  <div class="hr1">
    <a class="logo" href="#"><div class="lmark">T</div><span class="ltxt">tbilisi<em>price</em></span></a>

    <div class="sbox">
      <svg class="sico" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <input class="sinp" id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫: Samsung Galaxy S24, MacBook Air M3, AirPods Pro‚Ä¶" oninput="doSearch(this.value)">
      <button class="sclear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">√ó</button>
    </div>

    <div class="hacts">
      <button class="hbtn" id="themeBtn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
        <svg id="sunIco" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg id="moonIco" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
      </button>

      <div style="position:relative">
        <button class="hbtn" id="notifBtn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" onclick="togglePanel('notifPanel',this)">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
          <div class="nbadge" id="notifBadge">3</div>
        </button>
        <div class="dpanel dpanel-notif" id="notifPanel">
          <div class="dpn-header">
            <span class="dpn-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            <button class="dpn-mark" onclick="markAllRead()">–í—Å—ë –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</button>
          </div>
          <div class="notif-list" id="notifList"></div>
        </div>
      </div>

      <div style="position:relative">
        <button class="hbtn" id="favHdrBtn" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" onclick="togglePanel('favPanel',this)">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
          <div class="nbadge" id="favBadge" style="display:none">0</div>
        </button>
        <div class="dpanel dpanel-fav" id="favPanel">
          <div class="dpf-header"><span style="font-size:14px;font-weight:800">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span id="favCount" style="font-size:12px;color:var(--text3)">0 —Ç–æ–≤–∞—Ä–æ–≤</span></div>
          <div class="fav-list" id="favList">
            <div class="dpf-empty">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.<br>–ù–∞–∂–º–∏ ‚ô• –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ.</div>
          </div>
        </div>
      </div>

      <div style="position:relative">
        <div class="avatar" id="avatarBtn" onclick="togglePanel('profilePanel',null)">KG</div>
        <div class="dpanel dpanel-profile" id="profilePanel">
          <div class="prof-head">
            <div class="prof-av">KG</div>
            <div><div class="prof-name">Ketevan G.</div><div class="prof-email">ketevan@gmail.com</div></div>
          </div>
          <button class="prof-menu-item" onclick="openProfileModal();closeAllPanels()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
          </button>
          <button class="prof-menu-item" onclick="toast('–û—Ç–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–æ–∫‚Ä¶','info');closeAllPanels()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫
          </button>
          <button class="prof-menu-item" onclick="toast('üîî –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã','info');closeAllPanels()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>–ú–æ–∏ –∞–ª–µ—Ä—Ç—ã
          </button>
          <div class="prof-divider"></div>
          <button class="prof-menu-item danger" onclick="toast('–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω','error');closeAllPanels()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>–í—ã–π—Ç–∏
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="chips">
    <button class="chip active" onclick="filterCategory('all',this)">–í—Å—ë</button>
    <button class="chip" onclick="filterCategory('phone',this)">üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</button>
    <button class="chip" onclick="filterCategory('laptop',this)">üíª –ù–æ—É—Ç–±—É–∫–∏</button>
    <button class="chip" onclick="filterCategory('audio',this)">üéß –ê—É–¥–∏–æ</button>
    <button class="chip" onclick="filterCategory('watch',this)">‚åö –°–º–∞—Ä—Ç-—á–∞—Å—ã</button>
    <button class="chip" onclick="filterCategory('tablet',this)">üì± –ü–ª–∞–Ω—à–µ—Ç—ã</button>
    <button class="chip" onclick="filterCategory('camera',this)">üì∑ –ö–∞–º–µ—Ä—ã</button>
    <button class="chip" onclick="filterCategory('gaming',this)">üéÆ –ò–≥—Ä—ã</button>
  </div>
</header>

<!-- ‚ïê‚ïê LAYOUT ‚ïê‚ïê -->
<div class="layout" id="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sc">
      <div class="slab">–§–∏–ª—å—Ç—Ä—ã</div>
      <div class="fg">
        <span class="fl">–¶–µ–Ω–∞ (‚Çæ)</span>
        <div class="rrow"><span>–æ—Ç <span class="rv" id="pMin">0</span></span><span>–¥–æ <span class="rv" id="pMax">5 000</span></span></div>
        <input type="range" id="priceRange" min="0" max="10000" value="5000" oninput="updatePriceMax(this.value)">
      </div>
      <div class="fg">
        <span class="fl">–ë—Ä–µ–Ω–¥</span>
        <div class="bgrid">
          <div class="bi on" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">Apple</span></div>
          <div class="bi on" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">Samsung</span></div>
          <div class="bi" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">Sony</span></div>
          <div class="bi" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">Xiaomi</span></div>
          <div class="bi" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">ASUS</span></div>
          <div class="bi" onclick="this.classList.toggle('on')"><div class="bcb"></div><span class="bn">LG</span></div>
        </div>
      </div>
      <div class="fg">
        <span class="fl">–†–µ–π—Ç–∏–Ω–≥</span>
        <div class="ssel" id="starSel">
          <button class="sbtn" onclick="setStar(1)">‚òÖ</button>
          <button class="sbtn" onclick="setStar(2)">‚òÖ</button>
          <button class="sbtn on" onclick="setStar(3)">‚òÖ</button>
          <button class="sbtn on" onclick="setStar(4)">‚òÖ</button>
          <button class="sbtn on" onclick="setStar(5)">‚òÖ</button>
        </div>
      </div>
      <div class="fg" style="margin-bottom:0">
        <span class="fl">–ù–∞–ª–∏—á–∏–µ</span>
        <div class="trow"><span>–í –Ω–∞–ª–∏—á–∏–∏</span><button class="tog on" id="togStock" onclick="this.classList.toggle('on')"></button></div>
        <div class="trow"><span>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</span><button class="tog" onclick="this.classList.toggle('on')"></button></div>
        <div class="trow"><span>–ì–∞—Ä–∞–Ω—Ç–∏—è 2+ –≥–æ–¥–∞</span><button class="tog" onclick="this.classList.toggle('on')"></button></div>
        <div class="trow"><span>–†–∞—Å—Å—Ä–æ—á–∫–∞</span><button class="tog on" id="togCredit" onclick="this.classList.toggle('on')"></button></div>
      </div>
      <div class="arow">
        <button class="bfill" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="bghost" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </aside>

  <!-- CONTENT -->
  <main class="content" id="content">
    <div class="toolbar">
      <div class="trow2">
        <span class="ptitle">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</span>
        <span class="cpill" id="countPill">7</span>
        <button class="fbtn" id="filterBtn" onclick="toggleFilters()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="4" y1="6" x2="20" y2="6"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="11" y1="18" x2="13" y2="18"/></svg>
          –§–∏–ª—å—Ç—Ä—ã
        </button>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="vtabs">
          <button class="vtab active" onclick="setView('list',this)">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>–°–ø–∏—Å–æ–∫
          </button>
          <button class="vtab" onclick="setView('map',this)">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>–ö–∞—Ä—Ç–∞
          </button>
        </div>
        <div class="srow">
          <button class="srtbtn active" onclick="sortCards('price',this)">–î–µ—à–µ–≤–ª–µ</button>
          <button class="srtbtn" onclick="sortCards('popular',this)">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</button>
          <button class="srtbtn" onclick="sortCards('rating',this)">–†–µ–π—Ç–∏–Ω–≥</button>
          <button class="srtbtn" onclick="sortCards('discount',this)">–°–∫–∏–¥–∫–∞</button>
        </div>
      </div>
    </div>

    <div class="fresh">
      <div class="fdot"></div>
      –¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã <strong style="margin:0 2px">2 –º–∏–Ω –Ω–∞–∑–∞–¥</strong>
      <span class="sep">¬∑</span><span>12 –º–∞–≥–∞–∑–∏–Ω–æ–≤ –¢–±–∏–ª–∏—Å–∏</span>
      <span class="sep">¬∑</span><span style="color:var(--green)">‚Üì 3 —Å–Ω–∏–∂–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è</span>
      <button class="altbtn" onclick="openPriceModal()">üîî –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ü–µ–Ω—É</button>
    </div>

    <!-- LIST VIEW -->
    <div id="listView">
      <div class="clist" id="cardList"></div>
      <div class="nores" id="noResults">
        <div class="nores-ico">üîç</div>
        <div class="nores-t">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏</div>
        <div class="nores-s">–ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–ø—Ä–æ—Å–∏ LUMEN –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–Ω–∞–ª–æ–≥</div>
        <button class="bfill" style="margin-top:6px;flex:none;padding:0 20px;width:auto" onclick="openAI()">–°–ø—Ä–æ—Å–∏—Ç—å LUMEN</button>
      </div>
    </div>

    <!-- MAP VIEW -->
    <div id="mapView" class="mapview">
      <div class="mapc">
        <div class="mppanel">
          <div class="mphdr">–ú–∞–≥–∞–∑–∏–Ω—ã<span id="storeCount">12 –º–∞–≥–∞–∑–∏–Ω–æ–≤</span></div>
          <div class="slist" id="storeList"></div>
        </div>
        <div class="map-popup" id="mapPopup"></div>
        <svg style="width:100%;height:100%" viewBox="0 0 720 520" id="mapSvg">
          <defs>
            <linearGradient id="mg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#0D1320"/>
              <stop offset="100%" stop-color="#111827"/>
            </linearGradient>
          </defs>
          <rect width="720" height="520" fill="url(#mg)"/>
          <g stroke="rgba(255,255,255,0.03)" stroke-width="1">
            <line x1="0" y1="130" x2="720" y2="130"/><line x1="0" y1="260" x2="720" y2="260"/>
            <line x1="0" y1="390" x2="720" y2="390"/><line x1="180" y1="0" x2="180" y2="520"/>
            <line x1="360" y1="0" x2="360" y2="520"/><line x1="540" y1="0" x2="540" y2="520"/>
          </g>
          <path d="M0 280 Q80 260 140 270 Q200 280 240 265 Q290 250 340 260 Q390 270 440 255 Q490 240 540 250 Q600 260 650 248 Q680 242 720 245" stroke="#1E4A7A" stroke-width="16" fill="none" opacity=".7"/>
          <path d="M0 280 Q80 260 140 270 Q200 280 240 265 Q290 250 340 260 Q390 270 440 255 Q490 240 540 250 Q600 260 650 248 Q680 242 720 245" stroke="#2563EB" stroke-width="4" fill="none" opacity=".2"/>
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1.5" fill="none">
            <line x1="180" y1="240" x2="480" y2="240"/><line x1="120" y1="200" x2="420" y2="290"/>
            <line x1="280" y1="150" x2="280" y2="380"/><line x1="380" y1="160" x2="380" y2="370"/>
            <line x1="180" y1="150" x2="180" y2="400"/><line x1="480" y1="140" x2="480" y2="380"/>
            <line x1="100" y1="300" x2="620" y2="300"/><line x1="100" y1="350" x2="580" y2="350"/>
            <line x1="140" y1="180" x2="600" y2="200"/>
          </g>
          <g font-family="DM Sans,sans-serif" font-size="10" fill="rgba(255,255,255,0.12)" font-weight="600" letter-spacing="1">
            <text x="58" y="218">–°–ê–ë–£–†–¢–ê–õ–û</text><text x="280" y="198">–¶–ï–ù–¢–†</text>
            <text x="478" y="183">–ò–°–ê–ù–ò</text><text x="68" y="378">–ì–õ–î–ê–ù–ò</text>
            <text x="268" y="398">–î–ò–î–£–ë–ï</text><text x="488" y="388">–í–ê–†–ö–ï–¢–ò–õ–ò</text>
          </g>
          <text x="170" y="276" font-family="DM Sans,sans-serif" font-size="9" fill="rgba(96,165,250,.6)" font-weight="600">—Ä. –ú—Ç–∫–≤–∞—Ä–∏</text>
          <g id="pinGroup"></g>
        </svg>
      </div>
    </div>
  </main>

  <!-- AI DOCK -->
  <aside class="aidock">
    <div class="aiinner">
      <div class="lumhdr">
        <div class="lumorb"></div>
        <div>
          <div class="lum-name"><span>LUMEN</span></div>
          <div class="lum-stat"><div class="lsdot"></div>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é 142 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</div>
        </div>
        <button class="lcls" onclick="toggleAI()">√ó</button>
      </div>
      <div class="linst">
        <span class="inst-ico">üí°</span>
        <div class="inst-t">iPhone 15 Pro —Å–µ–π—á–∞—Å –Ω–∞ <strong>‚àí250‚Çæ –Ω–∏–∂–µ</strong> —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –≥–æ—Ä–æ–¥—É. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º –≤ iSpace –¥–æ—Å—Ç–∏–≥–Ω—É—Ç 3 –¥–Ω—è –Ω–∞–∑–∞–¥.</div>
      </div>
      <div class="qwrap">
        <button class="qbtn" onclick="quickAsk('–ù–∞–π–¥–∏ —Å–∞–º—ã–π –¥–µ—à—ë–≤—ã–π iPhone 15 –≤ –¢–±–∏–ª–∏—Å–∏')"><div class="qi">üìç</div>–°–∞–º—ã–π –¥–µ—à—ë–≤—ã–π iPhone 15</button>
        <button class="qbtn" onclick="quickAsk('–°—Ä–∞–≤–Ω–∏ Samsung S24 Ultra –∏ iPhone 15 Pro')"><div class="qi">‚öñÔ∏è</div>S24 Ultra vs iPhone 15 Pro</button>
        <button class="qbtn" onclick="quickAsk('MacBook Air M3 —Å —Ä–∞—Å—Å—Ä–æ—á–∫–æ–π 0%')"><div class="qi">üí≥</div>MacBook –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É 0%</button>
        <button class="qbtn" onclick="quickAsk('–¢–æ–ø —Å–∫–∏–¥–æ–∫ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫—É —Å–µ–≥–æ–¥–Ω—è')"><div class="qi">üî•</div>–¢–æ–ø —Å–∫–∏–¥–æ–∫ —Å–µ–≥–æ–¥–Ω—è</button>
      </div>
      <div class="msgs" id="chatMsgs">
        <div class="msg ai">
          <div class="mav">L</div>
          <div><div class="mbub">–ü—Ä–∏–≤–µ—Ç! –Ø <span class="ah">LUMEN</span> ‚Äî —Ç–≤–æ–π –ò–ò-–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ —Ü–µ–Ω–∞–º –¢–±–∏–ª–∏—Å–∏. –í–∏–∂—É <span class="ph">3 –≤—ã–≥–æ–¥–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞</span> –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å. –°–ø—Ä–æ—Å–∏ –æ –ª—é–±–æ–º —Ç–æ–≤–∞—Ä–µ!</div><span class="mtime">—Å–µ–π—á–∞—Å</span></div>
        </div>
      </div>
      <div class="cirow">
        <input class="cinp" id="chatInput" placeholder="–°–ø—Ä–æ—Å–∏ LUMEN‚Ä¶" onkeydown="if(event.key==='Enter')sendChat()">
        <button class="csnd" onclick="sendChat()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </aside>
</div>

<!-- COMPARE BAR -->
<div class="cmpbar" id="cmpBar">
  <div style="font-size:13px;font-weight:700;white-space:nowrap">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
  <div class="cmp-slots" id="cmpSlots">
    <div class="cslot" id="cs0">+ –î–æ–±–∞–≤–∏—Ç—å</div>
    <div class="cslot" id="cs1">+ –î–æ–±–∞–≤–∏—Ç—å</div>
    <div class="cslot" id="cs2">+ –î–æ–±–∞–≤–∏—Ç—å</div>
  </div>
  <button class="cmp-go" onclick="openCompareModal()">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
  <button class="cmp-x" onclick="clearCompare()">√ó</button>
</div>

<!-- LUMEN FAB -->
<button class="lfab" id="lumenFab" onclick="toggleAI()">
  <span class="lfabl">L</span>
  <span class="flabl">LUMEN AI</span>
</button>

<!-- PRICE MODAL -->
<div class="overlay" id="priceOverlay" onclick="if(event.target===this)closePriceModal()">
  <div class="modal" style="max-width:500px">
    <div class="mhdr">
      <div><div class="mtitle" id="priceModalTitle">–ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω</div><div class="msub" id="priceModalSub">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</div></div>
      <button class="mcls" onclick="closePriceModal()">√ó</button>
    </div>
    <div class="chart-area"><canvas id="priceChart" style="width:100%;height:100%"></canvas></div>
    <div class="pstats">
      <div class="sbox"><div class="sval" id="pmCur">‚Äî</div><div class="slbl">–°–µ–π—á–∞—Å</div></div>
      <div class="sbox"><div class="sval" id="pmMin">‚Äî</div><div class="slbl">–ú–∏–Ω–∏–º—É–º</div></div>
      <div class="sbox"><div class="sval" id="pmMax2">‚Äî</div><div class="slbl">–ú–∞–∫—Å–∏–º—É–º</div></div>
    </div>
    <div class="alrow">
      <div><div class="allbl">üîî –£–≤–µ–¥–æ–º–∏—Ç—å –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏</div><div class="alsub" id="alertSubtext">–ü—É—à –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –æ–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞</div></div>
      <button class="tog on" id="alertTog" onclick="this.classList.toggle('on');toast(this.classList.contains('on')?'üîî –ê–ª–µ—Ä—Ç –≤–∫–ª—é—á—ë–Ω':'üîï –ê–ª–µ—Ä—Ç –æ—Ç–∫–ª—é—á—ë–Ω','info')"></button>
    </div>
  </div>
</div>

<!-- COMPARE MODAL -->
<div class="overlay" id="cmpOverlay" onclick="if(event.target===this)document.getElementById('cmpOverlay').classList.remove('open')">
  <div class="modal cmp-modal">
    <div class="mhdr"><div><div class="mtitle">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤</div><div class="msub">–õ—É—á—à–∞—è —Ü–µ–Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –∑–µ–ª—ë–Ω—ã–º</div></div><button class="mcls" onclick="document.getElementById('cmpOverlay').classList.remove('open')">√ó</button></div>
    <div class="cmp-grid" id="cmpGrid"></div>
  </div>
</div>

<!-- PROFILE MODAL -->
<div class="overlay" id="profOverlay" onclick="if(event.target===this)document.getElementById('profOverlay').classList.remove('open')">
  <div class="modal prof-modal">
    <div class="mhdr"><div class="mtitle">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div><button class="mcls" onclick="document.getElementById('profOverlay').classList.remove('open')">√ó</button></div>
    <div class="prof-info">
      <div class="prof-av2">KG</div>
      <div><div class="prof-n">Ketevan Giorgadze</div><div class="prof-e">ketevan@gmail.com ¬∑ –¢–±–∏–ª–∏—Å–∏, –ì—Ä—É–∑–∏—è</div></div>
    </div>
    <div class="prof-stats">
      <div class="pst"><div class="pst-v" id="profFavCount">0</div><div class="pst-l">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div></div>
      <div class="pst"><div class="pst-v" id="profCmpCount">0</div><div class="pst-l">–°—Ä–∞–≤–Ω–µ–Ω–∏–π</div></div>
      <div class="pst"><div class="pst-v">12</div><div class="pst-l">–ê–ª–µ—Ä—Ç–æ–≤</div></div>
    </div>
    <button class="bfill" style="width:100%" onclick="toast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã ‚úì','success');document.getElementById('profOverlay').classList.remove('open')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
  </div>
</div>

<!-- STORE MODAL -->
<div class="overlay" id="storeOverlay" onclick="if(event.target===this)document.getElementById('storeOverlay').classList.remove('open')">
  <div class="modal store-modal">
    <div class="mhdr"><div><div class="mtitle" id="storeModalTitle">–ú–∞–≥–∞–∑–∏–Ω</div><div class="msub" id="storeModalSub"></div></div><button class="mcls" onclick="document.getElementById('storeOverlay').classList.remove('open')">√ó</button></div>
    <div id="storeModalGoods"></div>
  </div>
</div>

<!-- TOAST STACK -->
<div class="toast-stack" id="toastStack"></div>

<script>
// ‚ïê‚ïê DATA ‚ïê‚ïê
const products = [
  { id:1, name:'Apple iPhone 15 Pro, 256GB, Natural Titanium', emoji:'üì±', store:'iSpace ¬∑ –†—É—Å—Ç–∞–≤–µ–ª–∏', price:3249, oldPrice:3499, rating:4.9, reviews:'1.2k', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tb:–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π','to:–†–∞—Å—Å—Ä–æ—á–∫–∞ 0%'], category:'phone', brand:'Apple', best:true,
    priceHistory:[3599,3499,3499,3450,3380,3299,3249,3199,3099,3149,3249,3249,3299,3249,3249], url:'https://ispace.ge' },
  { id:2, name:'Samsung Galaxy S24 Ultra, 256GB, Titanium Black', emoji:'üì±', store:'Elit Electronics ¬∑ –î–∏–¥—É–±–µ', price:3490, oldPrice:3699, rating:4.8, reviews:'847', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tb:S Pen –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ','to:–†–∞—Å—Å—Ä–æ—á–∫–∞ 12 –º–µ—Å'], category:'phone', brand:'Samsung',
    priceHistory:[3799,3699,3699,3599,3599,3500,3490,3490,3490,3450,3490,3490,3490,3490,3490], url:'https://www.elitelectronics.ge' },
  { id:3, name:'Apple MacBook Air 13‚Ä≥ M3, 8GB/256GB, Midnight', emoji:'üíª', store:'iSpace ¬∑ –í–µ—Ä–∞', price:4190, oldPrice:4399, rating:5.0, reviews:'203', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tb:–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Apple','to:–†–∞—Å—Å—Ä–æ—á–∫–∞ 0%'], category:'laptop', brand:'Apple',
    priceHistory:[4599,4499,4399,4399,4299,4250,4190,4190,4190,4190,4190,4190,4190,4190,4190], url:'https://ispace.ge' },
  { id:4, name:'Sony WH-1000XM5, Wireless Noise Cancelling, Black', emoji:'üéß', store:'Alto ¬∑ –°–∞–±—É—Ä—Ç–∞–ª–æ', price:899, oldPrice:1099, rating:4.9, reviews:'634', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tb:30—á –±–∞—Ç–∞—Ä–µ—è'], category:'audio', brand:'Sony',
    priceHistory:[1099,1099,999,999,949,929,899,899,899,879,899,899,899,899,899], url:'https://alto.ge' },
  { id:5, name:'Apple AirPods Pro 2nd Gen, USB-C, MagSafe', emoji:'üéß', store:'iSpace ¬∑ –†—É—Å—Ç–∞–≤–µ–ª–∏', price:649, oldPrice:699, rating:4.8, reviews:'1.5k', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tb:–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π'], category:'audio', brand:'Apple',
    priceHistory:[699,699,699,679,669,659,649,649,649,639,649,649,649,649,649], url:'https://ispace.ge' },
  { id:6, name:'Apple Watch Series 9, 45mm GPS, Midnight', emoji:'‚åö', store:'iSpace ¬∑ –î–∏–¥—É–±–µ –ú–æ–ª–ª', price:1149, oldPrice:1249, rating:4.6, reviews:'428', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','to:–†–∞—Å—Å—Ä–æ—á–∫–∞'], category:'watch', brand:'Apple',
    priceHistory:[1299,1249,1249,1199,1199,1179,1149,1149,1149,1129,1149,1149,1149,1149,1149], url:'https://ispace.ge' },
  { id:7, name:'Samsung Galaxy Tab S9 FE, 10.9‚Ä≥, 128GB, Lavender', emoji:'üì±', store:'Elit Electronics ¬∑ –ì–ª–¥–∞–Ω–∏ –ú–æ–ª–ª', price:849, oldPrice:999, rating:4.4, reviews:'211', tags:['tg:–í –Ω–∞–ª–∏—á–∏–∏','tr:–û—Å—Ç–∞–ª–æ—Å—å 2 —à—Ç'], category:'tablet', brand:'Samsung',
    priceHistory:[999,999,979,969,949,899,849,849,849,839,849,849,849,849,849], url:'https://www.elitelectronics.ge' },
];

const stores = [
  {id:1,name:'iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏',sub:'–ü—Ä. –†—É—Å—Ç–∞–≤–µ–ª–∏ 42',x:340,y:238,color:'#4F7BFF',count:24,rating:'4.9',goods:[1,3,5,6]},
  {id:2,name:'iSpace –í–µ—Ä–∞',sub:'—É–ª. –í–∞–∂–∞-–ü—à–∞–≤–µ–ª–∞ 7',x:180,y:190,color:'#4F7BFF',count:22,rating:'4.8',goods:[3,5,6]},
  {id:3,name:'iSpace –î–∏–¥—É–±–µ –ú–æ–ª–ª',sub:'–ú–æ–ª–ª –î–∏–¥—É–±–µ',x:270,y:340,color:'#4F7BFF',count:20,rating:'4.7',goods:[6]},
  {id:4,name:'Elit Electronics',sub:'–°–∞–±—É—Ä—Ç–∞–ª–æ –ú–æ–ª–ª',x:115,y:225,color:'#F59E0B',count:31,rating:'4.6',goods:[2,7]},
  {id:5,name:'Elit Electronics',sub:'–ì–ª–¥–∞–Ω–∏ –ú–æ–ª–ª',x:110,y:370,color:'#F59E0B',count:28,rating:'4.5',goods:[7]},
  {id:6,name:'Alto Store',sub:'—É–ª. –ß–∞–≤—á–∞–≤–∞–¥–∑–µ 12',x:145,y:160,color:'#22C55E',count:19,rating:'4.8',goods:[4]},
  {id:7,name:'Alto Store',sub:'–í–∞—Ä–∫–µ—Ç–∏–ª–∏ –ú–æ–ª–ª',x:580,y:360,color:'#22C55E',count:15,rating:'4.4',goods:[4]},
  {id:8,name:'Zoommer',sub:'–ü—Ä. –ê–≥–º–∞—à–µ–Ω–µ–±–µ–ª–∏ 55',x:220,y:300,color:'#A855F7',count:42,rating:'4.3',goods:[1,2,4]},
  {id:9,name:'Zoommer',sub:'–ò—Å–∞–Ω–∏ –ú–æ–ª–ª',x:490,y:250,color:'#A855F7',count:38,rating:'4.2',goods:[2,7]},
  {id:10,name:'Samsung Store',sub:'–ü—Ä. –†—É—Å—Ç–∞–≤–µ–ª–∏ 8',x:310,y:236,color:'#3B82F6',count:16,rating:'4.7',goods:[2,7]},
  {id:11,name:'Sony Centre',sub:'–¢–±–∏–ª–∏—Å–∏ –ú–æ–ª–ª',x:600,y:180,color:'#EF4444',count:12,rating:'4.6',goods:[4]},
  {id:12,name:'Xiaomi Store',sub:'–î–∏–¥—É–±–µ –ë–∞–∑—Ä–∞—Ä–∏',x:255,y:355,color:'#F97316',count:21,rating:'4.5',goods:[]},
];

const notifs = [
  {id:1,title:'üéâ –¶–µ–Ω–∞ —Å–Ω–∏–∑–∏–ª–∞—Å—å!',sub:'iPhone 15 Pro —É–ø–∞–ª –¥–æ 3 249‚Çæ –≤ iSpace',time:'2 –º–∏–Ω –Ω–∞–∑–∞–¥',read:false},
  {id:2,title:'üî• –ì–æ—Ä—è—á–∞—è —Å–∫–∏–¥–∫–∞',sub:'Sony WH-1000XM5 ‚àí200‚Çæ –≤ Alto Store',time:'18 –º–∏–Ω –Ω–∞–∑–∞–¥',read:false},
  {id:3,title:'üì¶ –¢–æ–≤–∞—Ä –ø–æ—è–≤–∏–ª—Å—è',sub:'Samsung Tab S9 FE —Å–Ω–æ–≤–∞ –≤ –Ω–∞–ª–∏—á–∏–∏',time:'1 —á –Ω–∞–∑–∞–¥',read:false},
  {id:4,title:'üí≥ –ù–æ–≤–∞—è —Ä–∞—Å—Å—Ä–æ—á–∫–∞',sub:'MacBook Air M3 —Ç–µ–ø–µ—Ä—å –Ω–∞ 18 –º–µ—Å 0%',time:'3 —á –Ω–∞–∑–∞–¥',read:true},
  {id:5,title:'‚ö° –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞',sub:'AirPods Pro 2 –∑–∞ 649‚Çæ —Ç–æ–ª—å–∫–æ 24—á',time:'5 —á –Ω–∞–∑–∞–¥',read:true},
];

// ‚ïê‚ïê STATE ‚ïê‚ïê
let filtersOpen=false, aiOpen=false, dark=true;
let favItems=[], compareList=[], currentSort='price', currentCategory='all';
let activePriceProduct=null;
let rIdx=0;

// ‚ïê‚ïê INIT ‚ïê‚ïê
function init(){
  renderNotifs();
  renderCards(products);
  buildMap();
  document.addEventListener('click', e=>{
    if(!e.target.closest('[data-panel]')&&!e.target.closest('.dpanel')){
      closeAllPanels();
    }
  });
  // keyboard shortcut
  document.addEventListener('keydown',e=>{
    if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();document.getElementById('searchInput').focus();}
    if(e.key==='Escape'){closeAllPanels();closePriceModal();}
  });
}

// ‚ïê‚ïê RENDER CARDS ‚ïê‚ïê
function renderCards(list){
  const container=document.getElementById('cardList');
  const nores=document.getElementById('noResults');
  if(!list.length){container.innerHTML='';nores.classList.add('show');document.getElementById('countPill').textContent='0';return;}
  nores.classList.remove('show');
  document.getElementById('countPill').textContent=list.length;
  container.innerHTML=list.map(p=>cardHTML(p)).join('');
  // restore fav states
  favItems.forEach(fid=>{
    const fb=container.querySelector(`[data-fav="${fid}"]`);
    if(fb)fb.classList.add('on');
  });
  // restore compare states
  compareList.forEach(cid=>{
    const cb=container.querySelector(`[data-cmp="${cid}"]`);
    if(cb)cb.classList.add('cmp-on');
  });
}

function cardHTML(p){
  const disc=p.oldPrice-p.price;
  const tags=p.tags.map(t=>{const[cls,label]=t.split(':');return `<span class="tag ${cls}">${label}</span>`;}).join('');
  return `<div class="pcard${p.best?' best':''}" data-id="${p.id}" data-price="${p.price}" data-rating="${p.rating}" data-discount="${Math.round((disc/p.oldPrice)*100)}" onclick="cardClick(event,${p.id})">
    ${p.best?`<div style="position:absolute;top:12px;left:12px;z-index:2"><span class="tag tg" style="font-size:9px;height:16px">‚ú¶ –õ–£–ß–®–ê–Ø –¶–ï–ù–ê</span></div>`:''}
    <div class="thumb">${p.emoji}</div>
    <div class="cbody">
      <div class="cname">${p.name}</div>
      <div class="csub"><span>${p.store}</span>
        <div class="crat"><span class="ss">${'‚òÖ'.repeat(Math.floor(p.rating))}${'‚òÜ'.repeat(5-Math.floor(p.rating))}</span><span class="rv2">${p.rating}</span><span style="color:var(--text3);font-size:10px">(${p.reviews})</span></div>
      </div>
      <div class="ctags">${tags}</div>
    </div>
    <div class="cright">
      <div><div class="pmain">${p.price.toLocaleString()} ‚Çæ</div><div class="pold">${p.oldPrice.toLocaleString()} ‚Çæ</div><div class="pdiff">‚Üì ‚àí${disc.toLocaleString()} ‚Çæ</div></div>
      <div class="cbtns">
        <button class="bgo" onclick="event.stopPropagation();goToStore(${p.id})">–í –º–∞–≥–∞–∑–∏–Ω</button>
        <button class="bout" onclick="event.stopPropagation();openPriceModalFor(${p.id})">–ì—Ä–∞—Ñ–∏–∫</button>
        <button class="bout" data-cmp="${p.id}" onclick="event.stopPropagation();toggleCompare(this,${p.id},'${p.name.substring(0,22)}‚Ä¶')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
        <button class="fav" data-fav="${p.id}" onclick="event.stopPropagation();toggleFav(this,${p.id})">‚ô•</button>
      </div>
    </div>
  </div>`;
}

function cardClick(e,id){
  const p=products.find(x=>x.id===id);
  if(!p)return;
  openPriceModalFor(id);
}

// ‚ïê‚ïê GO TO STORE ‚ïê‚ïê
function goToStore(id){
  const p=products.find(x=>x.id===id);
  if(!p)return;
  toast(`–û—Ç–∫—Ä—ã–≤–∞–µ–º ${p.store.split(' ¬∑ ')[0]}‚Ä¶`,'info');
  setTimeout(()=>window.open(p.url,'_blank'),600);
}

// ‚ïê‚ïê SEARCH ‚ïê‚ïê
function doSearch(val){
  const q=val.toLowerCase().trim();
  if(!q){renderCards(getSortedFiltered(products));return;}
  const res=products.filter(p=>p.name.toLowerCase().includes(q)||p.store.toLowerCase().includes(q)||p.brand.toLowerCase().includes(q));
  renderCards(getSortedFiltered(res));
}
function clearSearch(){
  document.getElementById('searchInput').value='';
  doSearch('');
  document.getElementById('searchInput').focus();
}

// ‚ïê‚ïê FILTER / SORT ‚ïê‚ïê
function getSortedFiltered(list){
  let res=[...list];
  const maxP=parseInt(document.getElementById('priceRange').value)||10000;
  res=res.filter(p=>p.price<=maxP);
  if(currentCategory!=='all') res=res.filter(p=>p.category===currentCategory);
  if(currentSort==='price') res.sort((a,b)=>a.price-b.price);
  else if(currentSort==='rating') res.sort((a,b)=>b.rating-a.rating);
  else if(currentSort==='discount') res.sort((a,b)=>(b.oldPrice-b.price)-(a.oldPrice-a.price));
  else if(currentSort==='popular') res.sort((a,b)=>parseFloat(b.reviews)-parseFloat(a.reviews));
  return res;
}

function applyFilters(){
  toast('–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã ‚úì','success');
  renderCards(getSortedFiltered(products));
}
function resetFilters(){
  document.getElementById('priceRange').value=10000;
  document.getElementById('pMax').textContent='10 000';
  document.querySelectorAll('.bi').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.sbtn').forEach((b,i)=>b.classList.toggle('on',i>=2));
  document.getElementById('togStock').classList.add('on');
  document.getElementById('togCredit').classList.add('on');
  currentCategory='all';
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  document.querySelector('.chip').classList.add('active');
  renderCards(getSortedFiltered(products));
  toast('–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã','info');
}
function updatePriceMax(v){
  document.getElementById('pMax').textContent=parseInt(v).toLocaleString();
}
function sortCards(type,btn){
  currentSort=type;
  document.querySelectorAll('.srtbtn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderCards(getSortedFiltered(products));
}
function filterCategory(cat,btn){
  currentCategory=cat;
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');
  renderCards(getSortedFiltered(products));
}
function setStar(n){document.querySelectorAll('.sbtn').forEach((b,i)=>b.classList.toggle('on',i>=5-n));}

// ‚ïê‚ïê FAVOURITES ‚ïê‚ïê
function toggleFav(btn,id){
  btn.classList.toggle('on');
  const on=btn.classList.contains('on');
  const p=products.find(x=>x.id===id);
  if(on){
    if(!favItems.includes(id)) favItems.push(id);
    toast(`‚ù§Ô∏è ${p.name.substring(0,28)}‚Ä¶ –¥–æ–±–∞–≤–ª–µ–Ω`,'success');
  } else {
    favItems=favItems.filter(x=>x!==id);
    toast(`üíî –£–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ`,'info');
  }
  updateFavPanel();
}
function updateFavPanel(){
  const list=document.getElementById('favList');
  const badge=document.getElementById('favBadge');
  const count=document.getElementById('favCount');
  count.textContent=favItems.length+' —Ç–æ–≤–∞—Ä–æ–≤';
  badge.style.display=favItems.length>0?'flex':'none';
  badge.textContent=favItems.length;
  document.getElementById('profFavCount').textContent=favItems.length;
  if(!favItems.length){list.innerHTML='<div class="dpf-empty">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.<br>–ù–∞–∂–º–∏ ‚ô• –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ.</div>';return;}
  list.innerHTML=favItems.map(id=>{
    const p=products.find(x=>x.id===id);
    if(!p)return'';
    return `<div class="fav-item" onclick="openPriceModalFor(${p.id});closeAllPanels()">
      <div class="fav-thumb">${p.emoji}</div>
      <div style="flex:1;min-width:0"><div class="fav-name" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:12px">${p.name.substring(0,32)}‚Ä¶</div><div style="font-size:11px;color:var(--text3)">${p.store.split(' ¬∑ ')[0]}</div></div>
      <div class="fav-price">${p.price.toLocaleString()}‚Çæ</div>
      <button class="fav-remove" onclick="event.stopPropagation();removeFav(${p.id})">√ó</button>
    </div>`;
  }).join('');
}
function removeFav(id){
  favItems=favItems.filter(x=>x!==id);
  const btn=document.querySelector(`[data-fav="${id}"]`);
  if(btn)btn.classList.remove('on');
  updateFavPanel();
  toast('–£–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ','info');
}

// ‚ïê‚ïê COMPARE ‚ïê‚ïê
function toggleCompare(btn,id,name){
  const alreadyIn=compareList.includes(id);
  if(alreadyIn){
    btn.classList.remove('cmp-on');
    compareList=compareList.filter(x=>x!==id);
    refreshCmpBar();
    if(!compareList.length)document.getElementById('cmpBar').classList.remove('vis');
    toast(`–£–±—Ä–∞–Ω–æ –∏–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è`,'info');
    return;
  }
  if(compareList.length>=3){toast('–ú–∞–∫—Å–∏–º—É–º 3 —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è','error');return;}
  btn.classList.add('cmp-on');
  compareList.push(id);
  document.getElementById('cmpBar').classList.add('vis');
  refreshCmpBar();
  toast(`‚öñÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ`,'info');
  document.getElementById('profCmpCount').textContent=compareList.length;
}
function refreshCmpBar(){
  for(let i=0;i<3;i++){
    const sl=document.getElementById(`cs${i}`);
    const pid=compareList[i];
    if(pid){const p=products.find(x=>x.id===pid);sl.textContent=p?p.name.substring(0,20)+'‚Ä¶':'+';sl.classList.add('fill');}
    else{sl.textContent='+ –î–æ–±–∞–≤–∏—Ç—å';sl.classList.remove('fill');}
  }
}
function clearCompare(){
  compareList=[];
  document.getElementById('cmpBar').classList.remove('vis');
  document.querySelectorAll('[data-cmp]').forEach(b=>b.classList.remove('cmp-on'));
  refreshCmpBar();
  document.getElementById('profCmpCount').textContent=0;
  toast('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—á–∏—â–µ–Ω–æ','info');
}
function openCompareModal(){
  if(compareList.length<2){toast('–î–æ–±–∞–≤—å –º–∏–Ω–∏–º—É–º 2 —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è','error');return;}
  const prods=compareList.map(id=>products.find(p=>p.id===id));
  const minPrice=Math.min(...prods.map(p=>p.price));
  const grid=document.getElementById('cmpGrid');
  grid.style.gridTemplateColumns=`repeat(${prods.length},1fr)`;
  const specs=[
    {k:'–¶–µ–Ω–∞',v:p=>`${p.price.toLocaleString()} ‚Çæ`},
    {k:'–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞',v:p=>`${p.oldPrice.toLocaleString()} ‚Çæ`},
    {k:'–°–∫–∏–¥–∫–∞',v:p=>`‚àí${p.oldPrice-p.price} ‚Çæ`},
    {k:'–†–µ–π—Ç–∏–Ω–≥',v:p=>`‚òÖ ${p.rating}`},
    {k:'–û—Ç–∑—ã–≤—ã',v:p=>p.reviews},
    {k:'–ú–∞–≥–∞–∑–∏–Ω',v:p=>p.store.split(' ¬∑ ')[0]},
    {k:'–†–∞—Å—Å—Ä–æ—á–∫–∞',v:p=>p.tags.some(t=>t.includes('–†–∞—Å—Å—Ä–æ—á–∫–∞'))?'‚úì':'‚Äî'},
  ];
  grid.innerHTML=prods.map(p=>`
    <div class="cmp-col${p.price===minPrice?' best-col':''}">
      <div style="font-size:20px;text-align:center;margin-bottom:4px">${p.emoji}</div>
      <div class="cmp-prod">${p.name.substring(0,50)}</div>
      <div class="cmp-store">${p.store}</div>
      <div class="cmp-price">${p.price.toLocaleString()} ‚Çæ${p.price===minPrice?'<span class="cmp-best-badge" style="margin-left:6px">–õ–£–ß–®–ê–Ø</span>':''}</div>
      ${specs.slice(1).map(s=>`<div class="cmp-row"><span class="cmp-row-k">${s.k}</span><span class="cmp-row-v">${s.v(p)}</span></div>`).join('')}
      <button class="bgo" style="width:100%;margin-top:8px" onclick="goToStore(${p.id})">–í –º–∞–≥–∞–∑–∏–Ω</button>
    </div>`).join('');
  document.getElementById('cmpOverlay').classList.add('open');
}

// ‚ïê‚ïê PRICE MODAL ‚ïê‚ïê
function openPriceModalFor(id){
  const p=products.find(x=>x.id===id);
  if(!p)return;
  activePriceProduct=p;
  document.getElementById('priceModalTitle').textContent='–ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω ‚Äî '+p.name.substring(0,40);
  document.getElementById('priceModalSub').textContent=p.store+' ¬∑ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π';
  const prices=p.priceHistory;
  document.getElementById('pmCur').textContent=p.price.toLocaleString()+'‚Çæ';
  document.getElementById('pmMin').textContent=Math.min(...prices).toLocaleString()+'‚Çæ';
  document.getElementById('pmMax2').textContent=Math.max(...prices).toLocaleString()+'‚Çæ';
  document.getElementById('alertSubtext').textContent=`–ü—É—à –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –æ–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∏–∂–µ ${Math.round(p.price*0.95).toLocaleString()} ‚Çæ`;
  document.getElementById('priceOverlay').classList.add('open');
  requestAnimationFrame(()=>drawChart(prices));
}
function openPriceModal(){openPriceModalFor(1);}
function closePriceModal(){document.getElementById('priceOverlay').classList.remove('open');}

function drawChart(prices){
  const canvas=document.getElementById('priceChart');
  const W=canvas.parentElement.offsetWidth||440,H=130;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  const mn=Math.min(...prices)-80,mx=Math.max(...prices)+80;
  const pts=prices.map((p,i)=>({x:(i/(prices.length-1))*(W-20)+10,y:H-20-((p-mn)/(mx-mn))*(H-30)}));
  const isDark=document.documentElement.getAttribute('data-theme')!=='light';
  const lineColor=isDark?'#4F7BFF':'#3B5BDB';
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,isDark?'rgba(79,123,255,0.28)':'rgba(59,91,219,0.18)');
  grad.addColorStop(1,'rgba(79,123,255,0)');
  ctx.beginPath();ctx.moveTo(pts[0].x,H);
  pts.forEach(p=>ctx.lineTo(p.x,p.y));
  ctx.lineTo(pts[pts.length-1].x,H);ctx.closePath();
  ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);
  for(let i=1;i<pts.length;i++){const cx=(pts[i-1].x+pts[i].x)/2;ctx.bezierCurveTo(cx,pts[i-1].y,cx,pts[i].y,pts[i].x,pts[i].y);}
  ctx.strokeStyle=lineColor;ctx.lineWidth=2.5;ctx.stroke();
  // Min/max labels
  const minIdx=prices.indexOf(Math.min(...prices));
  const maxIdx=prices.indexOf(Math.max(...prices));
  ctx.font='bold 9px DM Mono, monospace';
  ctx.fillStyle='#22C55E';ctx.textAlign='center';
  ctx.fillText(Math.min(...prices).toLocaleString()+'‚Çæ',pts[minIdx].x,pts[minIdx].y-6);
  ctx.fillStyle='#F43F5E';
  ctx.fillText(Math.max(...prices).toLocaleString()+'‚Çæ',pts[maxIdx].x,pts[maxIdx].y-6);
  // Current dot
  const last=pts[pts.length-1];
  ctx.beginPath();ctx.arc(last.x,last.y,5,0,Math.PI*2);ctx.fillStyle=lineColor;ctx.fill();
  ctx.beginPath();ctx.arc(last.x,last.y,2.5,0,Math.PI*2);ctx.fillStyle='white';ctx.fill();
}

// ‚ïê‚ïê NOTIFICATIONS ‚ïê‚ïê
function renderNotifs(){
  const list=document.getElementById('notifList');
  list.innerHTML=notifs.map(n=>`
    <div class="notif-item${n.read?'':' unread'}" onclick="readNotif(${n.id})">
      <div class="ni-dot${n.read?' read':''}"></div>
      <div class="ni-body"><div class="ni-title">${n.title}</div><div class="ni-sub">${n.sub}</div><div class="ni-time">${n.time}</div></div>
    </div>`).join('');
  updateNotifBadge();
}
function readNotif(id){const n=notifs.find(x=>x.id===id);if(n)n.read=true;renderNotifs();}
function markAllRead(){notifs.forEach(n=>n.read=true);renderNotifs();toast('–í—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ','success');}
function updateNotifBadge(){
  const unread=notifs.filter(n=>!n.read).length;
  const badge=document.getElementById('notifBadge');
  badge.textContent=unread;badge.style.display=unread?'flex':'none';
}

// ‚ïê‚ïê MAP ‚ïê‚ïê
let activeStoreId=null;
function buildMap(){
  const sl=document.getElementById('storeList');
  const pg=document.getElementById('pinGroup');
  sl.innerHTML='';pg.innerHTML='';
  stores.forEach(s=>{
    const item=document.createElement('div');
    item.className='si';item.id=`si-${s.id}`;
    item.innerHTML=`<div style="display:flex;align-items:center"><span class="sdot" style="background:${s.color}"></span><div class="si-name">${s.name}</div></div><div class="si-sub">${s.sub} ¬∑ <span>${s.count} —Ç–æ–≤–∞—Ä–æ–≤</span> ¬∑ ‚òÖ ${s.rating}</div>`;
    item.onclick=()=>selectStore(s.id);
    sl.appendChild(item);
    const g=document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class','map-pin');g.setAttribute('id',`pin-${s.id}`);
    g.setAttribute('transform',`translate(${s.x},${s.y})`);
    g.innerHTML=`<circle r="14" fill="${s.color}" opacity=".12"/><circle r="8" fill="${s.color}"/><circle r="3" fill="white"/><text y="-18" text-anchor="middle" font-family="DM Sans,sans-serif" font-size="9" font-weight="700" fill="rgba(255,255,255,.85)">${s.name.split(' ')[0]}</text>`;
    g.onclick=()=>openStoreModal(s.id);
    pg.appendChild(g);
  });
}
function selectStore(id){
  document.querySelectorAll('.si').forEach(i=>i.classList.remove('active'));
  document.querySelectorAll('.map-pin').forEach(p=>p.classList.remove('active'));
  if(activeStoreId===id){activeStoreId=null;return;}
  activeStoreId=id;
  document.getElementById(`si-${id}`)?.classList.add('active');
  document.getElementById(`pin-${id}`)?.classList.add('active');
  openStoreModal(id);
}
function openStoreModal(id){
  const s=stores.find(x=>x.id===id);if(!s)return;
  document.getElementById('storeModalTitle').textContent=s.name;
  document.getElementById('storeModalSub').textContent=s.sub+' ¬∑ ‚òÖ '+s.rating+' ¬∑ '+s.count+' —Ç–æ–≤–∞—Ä–æ–≤';
  const goods=s.goods.map(gid=>products.find(p=>p.id===gid)).filter(Boolean);
  const cont=document.getElementById('storeModalGoods');
  if(!goods.length){cont.innerHTML='<div style="text-align:center;color:var(--text3);padding:20px;font-size:13px">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö</div>';
  }else{
    cont.innerHTML=`<div class="si-goods">${goods.map(p=>`
      <div class="sg-item">
        <span style="font-size:20px;margin-right:8px">${p.emoji}</span>
        <div class="sg-name" style="flex:1">${p.name.substring(0,35)}‚Ä¶</div>
        <div class="sg-price">${p.price.toLocaleString()}‚Çæ</div>
        <button class="bgo" style="margin-left:10px;height:28px;padding:0 10px;font-size:11px" onclick="goToStore(${p.id})">–ö—É–ø–∏—Ç—å</button>
      </div>`).join('')}</div>`;
  }
  document.getElementById('storeOverlay').classList.add('open');
}

// ‚ïê‚ïê PANELS / LAYOUT ‚ïê‚ïê
function togglePanel(id,btn){
  const panel=document.getElementById(id);
  const isOpen=panel.classList.contains('open');
  closeAllPanels();
  if(!isOpen){panel.classList.add('open');if(btn)btn.classList.add('on');}
}
function closeAllPanels(){
  document.querySelectorAll('.dpanel').forEach(p=>p.classList.remove('open'));
  document.querySelectorAll('.hbtn').forEach(b=>b.classList.remove('on'));
}
function toggleFilters(){
  filtersOpen=!filtersOpen;
  document.getElementById('filterBtn').classList.toggle('active',filtersOpen);
  updateLayout();
}
function toggleAI(){
  aiOpen=!aiOpen;
  document.getElementById('lumenFab').style.opacity=aiOpen?'.6':'1';
  updateLayout();
}
function openAI(){if(!aiOpen)toggleAI();}
function updateLayout(){
  const l=document.getElementById('layout');
  l.className='layout';
  if(filtersOpen&&aiOpen)l.classList.add('fao');
  else if(filtersOpen)l.classList.add('fo');
  else if(aiOpen)l.classList.add('ao');
}
function setView(v,btn){
  document.querySelectorAll('.vtab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('listView').style.display=v==='list'?'':'none';
  document.getElementById('mapView').classList.toggle('active',v==='map');
  if(v==='map')buildMap();
}

// ‚ïê‚ïê THEME ‚ïê‚ïê
document.getElementById('themeBtn').onclick=()=>{
  dark=!dark;
  document.documentElement.setAttribute('data-theme',dark?'dark':'light');
  document.getElementById('sunIco').style.display=dark?'none':'';
  document.getElementById('moonIco').style.display=dark?'':'none';
};

// ‚ïê‚ïê PROFILE MODAL ‚ïê‚ïê
function openProfileModal(){
  document.getElementById('profFavCount').textContent=favItems.length;
  document.getElementById('profCmpCount').textContent=compareList.length;
  document.getElementById('profOverlay').classList.add('open');
}

// ‚ïê‚ïê CHAT ‚ïê‚ïê
const lumenReplies=[
  q=>`–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é <em>"${q.slice(0,28)}‚Ä¶"</em> üîç<br><br>üìç –ù–∞—à—ë–ª <strong>3 –º–∞–≥–∞–∑–∏–Ω–∞</strong> —Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏.<br>üèÜ –õ—É—á—à–∞—è —Ü–µ–Ω–∞: <span class="ph">iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏ ‚Äî 3 249‚Çæ</span><br>üí° –≠–∫–æ–Ω–æ–º–∏—è: ‚àí250‚Çæ –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –¢–±–∏–ª–∏—Å–∏.`,
  ()=>`–°—Ä–∞–≤–Ω–µ–Ω–∏–µ Samsung S24 Ultra vs iPhone 15 Pro:<br><br>üì± <strong>S24 Ultra</strong> ‚Äî 3 490‚Çæ ¬∑ Android ¬∑ S Pen ¬∑ 200MP<br>üì± <strong>iPhone 15 Pro</strong> ‚Äî 3 249‚Çæ ¬∑ iOS ¬∑ USB-C ¬∑ Titanium<br><br>üí° iPhone —Å–µ–π—á–∞—Å –≤—ã–≥–æ–¥–Ω–µ–µ –Ω–∞ 241‚Çæ. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ Apple ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä.`,
  ()=>`MacBook Air M3 –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É 0%:<br><br>‚úÖ <span class="ph">iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏</span> ‚Äî 4 190‚Çæ ¬∑ 12 –º–µ—Å ¬∑ 0%<br>‚úÖ <span class="ph">iSpace –í–µ—Ä–∞</span> ‚Äî 4 190‚Çæ ¬∑ 6 –º–µ—Å ¬∑ 0%<br>‚úÖ Elit Electronics ‚Äî 4 290‚Çæ ¬∑ 18 –º–µ—Å ¬∑ 3%<br><br>–†–µ–∫–æ–º–µ–Ω–¥—É—é iSpace ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–∏–ª–µ—Ä.`,
  ()=>`üî• –¢–æ–ø —Å–∫–∏–¥–æ–∫ —Å–µ–≥–æ–¥–Ω—è:<br><br>1. <span class="ph">Sony WH-1000XM5</span> ‚Äî 899‚Çæ (‚àí18%)<br>2. <span class="ph">Samsung Tab S9 FE</span> ‚Äî 849‚Çæ (‚àí15%)<br>3. <span class="ph">iPhone 15 Pro</span> ‚Äî 3 249‚Çæ (‚àí7%)<br>4. <span class="ph">AirPods Pro 2</span> ‚Äî 649‚Çæ (‚àí7%)<br><br>–¶–µ–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã –Ω–∞ —Å–µ–π—á–∞—Å ‚úì`,
];
function addMsg(text,role){
  const m=document.getElementById('chatMsgs');
  const d=document.createElement('div');d.className=`msg ${role}`;
  d.innerHTML=`<div class="mav">${role==='ai'?'L':'KG'}</div><div><div class="mbub">${text}</div><span class="mtime">—Å–µ–π—á–∞—Å</span></div>`;
  m.appendChild(d);m.scrollTop=m.scrollHeight;
}
function addTyping(){
  const m=document.getElementById('chatMsgs');
  const d=document.createElement('div');d.className='msg ai';d.id='typing';
  d.innerHTML=`<div class="mav">L</div><div><div class="mbub"><div class="dots"><span></span><span></span><span></span></div></div></div>`;
  m.appendChild(d);m.scrollTop=m.scrollHeight;
}
function removeTyping(){document.getElementById('typing')?.remove();}
function sendChat(){
  const inp=document.getElementById('chatInput');
  const txt=inp.value.trim();if(!txt)return;
  inp.value='';
  if(!aiOpen){aiOpen=true;updateLayout();}
  addMsg(txt,'u');addTyping();
  setTimeout(()=>{removeTyping();addMsg(lumenReplies[rIdx%lumenReplies.length](txt),'ai');rIdx++;},1500);
}
function quickAsk(q){
  if(!aiOpen){aiOpen=true;updateLayout();}
  addMsg(q,'u');addTyping();
  setTimeout(()=>{removeTyping();addMsg(lumenReplies[rIdx%lumenReplies.length](q),'ai');rIdx++;},1500);
}

// ‚ïê‚ïê TOAST ‚ïê‚ïê
function toast(msg,type='info'){
  const stack=document.getElementById('toastStack');
  const d=document.createElement('div');
  const icons={success:'‚úì',error:'‚úï',info:'‚Ñπ'};
  d.className=`toast ${type}`;
  d.innerHTML=`<span class="ti">${icons[type]||'‚Ñπ'}</span>${msg}`;
  stack.appendChild(d);
  setTimeout(()=>d.remove(),2700);
}

init();
</script>
</body>
</html>
