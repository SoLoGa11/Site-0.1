<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TbilisiPrice ‚Äî –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080C14;
  --bg1: #0D1320;
  --bg2: #111827;
  --bg3: #1A2235;
  --text: #F0F4FF;
  --text2: #8B9AB5;
  --text3: #4B5A72;
  --accent: #4F7BFF;
  --accent2: #7C9FFF;
  --accent-glow: rgba(79,123,255,0.18);
  --accent-glow2: rgba(79,123,255,0.06);
  --green: #22C55E;
  --green-bg: rgba(34,197,94,0.1);
  --orange: #F59E0B;
  --orange-bg: rgba(245,158,11,0.1);
  --red: #F43F5E;
  --red-bg: rgba(244,63,94,0.08);
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.04);
  --shadow: 0 2px 12px rgba(0,0,0,0.4);
  --shadow2: 0 8px 40px rgba(0,0,0,0.6);
  --r: 14px;
  --r2: 10px;
  --r3: 20px;
}
[data-theme="light"] {
  --bg: #F0F4FF;
  --bg1: #FFFFFF;
  --bg2: #F8FAFF;
  --bg3: #EEF2FF;
  --text: #0A0F1E;
  --text2: #4B5A72;
  --text3: #94A3B8;
  --accent: #3B5BDB;
  --accent2: #4F6EE8;
  --accent-glow: rgba(59,91,219,0.12);
  --accent-glow2: rgba(59,91,219,0.05);
  --border: rgba(0,0,0,0.08);
  --border2: rgba(0,0,0,0.04);
  --shadow: 0 2px 12px rgba(0,0,0,0.08);
  --shadow2: 0 8px 40px rgba(0,0,0,0.12);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'DM Sans', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  transition: background .4s, color .4s;
  overflow-x: hidden;
}

/* ‚îÄ NOISE OVERLAY ‚îÄ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
  opacity: .5;
}

/* ‚îÄ AMBIENT GLOW ‚îÄ */
.ambient {
  position: fixed;
  border-radius: 50%;
  filter: blur(120px);
  pointer-events: none;
  z-index: 0;
}
.ambient-1 {
  width: 600px; height: 400px;
  background: rgba(79,123,255,0.06);
  top: -100px; left: -100px;
}
.ambient-2 {
  width: 400px; height: 400px;
  background: rgba(124,159,255,0.04);
  bottom: 20%; right: -50px;
}

/* ‚îÄ HEADER ‚îÄ */
header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(8,12,20,0.82);
  backdrop-filter: blur(20px) saturate(1.4);
  -webkit-backdrop-filter: blur(20px) saturate(1.4);
  border-bottom: 1px solid var(--border);
  padding: 0 28px;
}
[data-theme="light"] header { background: rgba(240,244,255,0.88); }

.header-row1 {
  display: flex; align-items: center;
  gap: 20px; height: 62px;
}

.logo {
  display: flex; align-items: center; gap: 10px;
  text-decoration: none; flex-shrink: 0; min-width: 148px;
}
.logo-mark {
  width: 34px; height: 34px;
  background: var(--accent);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  position: relative;
  box-shadow: 0 0 0 1px rgba(79,123,255,0.5), 0 4px 16px rgba(79,123,255,0.3);
}
.logo-mark::after {
  content: 'T';
  color: white;
  font-size: 16px;
  font-weight: 800;
  letter-spacing: -1px;
}
.logo-text {
  font-size: 16px; font-weight: 800;
  color: var(--text); letter-spacing: -0.5px;
}
.logo-text em {
  font-style: normal;
  color: var(--accent);
}

/* SEARCH */
.search-box {
  flex: 1; max-width: 600px;
  position: relative;
}
.search-input {
  width: 100%; height: 42px;
  background: var(--bg2);
  border: 1.5px solid var(--border);
  border-radius: 100px;
  padding: 0 100px 0 42px;
  font-family: inherit; font-size: 14px; font-weight: 500;
  color: var(--text); outline: none;
  transition: border-color .2s, box-shadow .2s, background .2s;
}
.search-input::placeholder { color: var(--text3); font-weight: 400; }
.search-input:focus {
  border-color: var(--accent);
  background: var(--bg1);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.search-ico {
  position: absolute; left: 14px; top: 50%;
  transform: translateY(-50%);
  color: var(--text3); pointer-events: none;
}
.search-badge {
  position: absolute; right: 10px; top: 50%;
  transform: translateY(-50%);
  display: flex; gap: 4px;
}
.kbd {
  background: var(--bg3); color: var(--text3);
  font-family: 'DM Mono', monospace; font-size: 10px;
  padding: 2px 6px; border-radius: 5px;
  border: 1px solid var(--border);
}

/* NAV CHIPS */
.nav-chips {
  display: flex; gap: 5px;
  padding: 9px 0 10px;
  margin-left: 44px;
}
.chip {
  height: 26px; padding: 0 12px;
  border-radius: 100px;
  border: 1px solid var(--border);
  background: transparent;
  font-family: inherit; font-size: 11.5px; font-weight: 600;
  color: var(--text2); cursor: pointer;
  transition: all .15s; white-space: nowrap;
  letter-spacing: 0.1px;
}
.chip:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow2); }
.chip.active {
  background: var(--accent); border-color: var(--accent);
  color: white; box-shadow: 0 2px 8px rgba(79,123,255,0.3);
}

/* HEADER ACTIONS */
.h-actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
.h-btn {
  width: 36px; height: 36px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: 10px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  color: var(--text2); transition: all .15s;
  position: relative;
}
.h-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow2); }
.h-btn .badge {
  position: absolute; top: -4px; right: -4px;
  width: 14px; height: 14px;
  background: var(--red); border-radius: 50%;
  font-size: 8px; font-weight: 700; color: white;
  display: flex; align-items: center; justify-content: center;
  border: 2px solid var(--bg);
}
.avatar {
  width: 34px; height: 34px; border-radius: 50%;
  background: linear-gradient(135deg, #4F7BFF, #818CF8);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 800; color: white;
  border: 2px solid var(--border); cursor: pointer;
  transition: transform .15s, box-shadow .15s;
}
.avatar:hover { transform: scale(1.05); box-shadow: 0 0 0 3px var(--accent-glow); }

/* ‚îÄ LAYOUT ‚îÄ */
.layout {
  display: grid;
  grid-template-columns: 0px 1fr 0px;
  gap: 0;
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px 28px;
  align-items: start;
  transition: grid-template-columns .35s cubic-bezier(.4,0,.2,1), gap .35s;
  position: relative; z-index: 1;
}
.layout.f-open { grid-template-columns: 288px 1fr 0px; gap: 20px; }
.layout.a-open { grid-template-columns: 0px 1fr 368px; gap: 20px; }
.layout.fa-open { grid-template-columns: 288px 1fr 368px; gap: 20px; }

/* ‚îÄ SIDEBAR ‚îÄ */
.sidebar {
  overflow: hidden;
  opacity: 0; transform: translateX(-10px);
  transition: opacity .3s, transform .3s;
  pointer-events: none;
}
.f-open .sidebar, .fa-open .sidebar {
  opacity: 1; transform: none; pointer-events: all;
}
.sidebar-card {
  background: var(--bg1);
  border: 1px solid var(--border);
  border-radius: var(--r3);
  padding: 20px;
  box-shadow: var(--shadow);
  position: sticky; top: 108px;
  min-width: 268px;
}

.slab { font-size: 10px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 14px; }
.fgroup { margin-bottom: 20px; }
.flabel { font-size: 12px; font-weight: 600; color: var(--text2); margin-bottom: 10px; display: block; }

/* Range */
.range-row { display: flex; justify-content: space-between; font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text3); margin-bottom: 8px; }
.range-val { color: var(--accent); font-weight: 500; }
input[type=range] {
  width: 100%; -webkit-appearance: none; height: 3px;
  border-radius: 2px; background: var(--bg3); outline: none; cursor: pointer;
  accent-color: var(--accent);
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 15px; height: 15px; border-radius: 50%;
  background: var(--accent); cursor: pointer;
  box-shadow: 0 0 0 3px var(--accent-glow), 0 1px 4px rgba(79,123,255,.4);
  transition: transform .15s;
}
input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

/* Brands */
.brand-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
.brand-item {
  display: flex; align-items: center; gap: 7px;
  padding: 7px 10px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--r2); cursor: pointer;
  transition: all .15s;
}
.brand-item:hover { border-color: var(--accent); background: var(--accent-glow2); }
.brand-item.on { border-color: var(--accent); background: var(--accent-glow); }
.brand-cb { width: 14px; height: 14px; border: 1.5px solid var(--border); border-radius: 4px; flex-shrink: 0; transition: all .15s; display: flex; align-items: center; justify-content: center; }
.brand-item.on .brand-cb { background: var(--accent); border-color: var(--accent); }
.brand-item.on .brand-cb::after { content: '‚úì'; color: white; font-size: 9px; font-weight: 800; }
.brand-name { font-size: 12px; font-weight: 600; color: var(--text2); }

/* Toggle */
.tog-row { display: flex; align-items: center; justify-content: space-between; padding: 7px 0; cursor: pointer; }
.tog-row span { font-size: 13px; font-weight: 500; color: var(--text); }
.tog { width: 34px; height: 18px; background: var(--bg3); border-radius: 100px; position: relative; border: none; cursor: pointer; transition: background .2s; }
.tog.on { background: var(--accent); }
.tog::after { content: ''; position: absolute; width: 12px; height: 12px; background: white; border-radius: 50%; top: 3px; left: 3px; transition: left .2s; box-shadow: 0 1px 3px rgba(0,0,0,.3); }
.tog.on::after { left: 19px; }

/* Stars */
.stars-sel { display: flex; gap: 3px; }
.star-btn {
  width: 30px; height: 26px; border: 1px solid var(--border);
  background: var(--bg2); border-radius: 7px; cursor: pointer;
  font-size: 13px; transition: all .15s; display: flex; align-items: center; justify-content: center;
}
.star-btn.on { background: rgba(245,158,11,.15); border-color: var(--orange); }

.apply-row { display: flex; gap: 8px; margin-top: 6px; padding-top: 16px; border-top: 1px solid var(--border); }
.btn-fill {
  flex: 1; height: 36px; background: var(--accent); color: white; border: none;
  border-radius: var(--r2); font-family: inherit; font-size: 13px; font-weight: 700;
  cursor: pointer; transition: background .15s, transform .1s;
  box-shadow: 0 4px 14px rgba(79,123,255,.25);
}
.btn-fill:hover { background: var(--accent2); }
.btn-fill:active { transform: scale(.98); }
.btn-ghost {
  height: 36px; padding: 0 14px; background: transparent; border: 1px solid var(--border);
  border-radius: var(--r2); font-family: inherit; font-size: 12px; font-weight: 600;
  color: var(--text2); cursor: pointer; transition: all .15s;
}
.btn-ghost:hover { border-color: var(--text2); color: var(--text); }

/* ‚îÄ MAIN CONTENT ‚îÄ */
.content { min-width: 0; }

/* TABS */
.view-tabs { display: flex; gap: 3px; background: var(--bg2); padding: 3px; border-radius: var(--r2); border: 1px solid var(--border); }
.vtab {
  flex: 1; height: 30px; background: transparent; border: none;
  border-radius: 8px; font-family: inherit; font-size: 12px; font-weight: 600;
  color: var(--text2); cursor: pointer; transition: all .15s;
  display: flex; align-items: center; justify-content: center; gap: 5px;
}
.vtab.active { background: var(--bg1); color: var(--text); box-shadow: var(--shadow); }

/* TOOLBAR */
.toolbar {
  display: flex; align-items: center;
  justify-content: space-between; gap: 12px;
  margin-bottom: 14px; flex-wrap: wrap;
}
.title-row { display: flex; align-items: center; gap: 10px; }
.page-title { font-size: 19px; font-weight: 800; letter-spacing: -0.5px; }
.count-pill {
  font-size: 11px; font-weight: 700; color: var(--text3);
  background: var(--bg2); border: 1px solid var(--border);
  padding: 2px 9px; border-radius: 100px;
  font-family: 'DM Mono', monospace;
}
.filter-btn {
  display: flex; align-items: center; gap: 5px;
  height: 32px; padding: 0 12px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--r2); font-family: inherit;
  font-size: 11px; font-weight: 700; color: var(--text2);
  cursor: pointer; transition: all .15s; text-transform: uppercase; letter-spacing: .5px;
}
.filter-btn.active, .filter-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow2); }

.sort-row { display: flex; gap: 3px; }
.sort-btn {
  height: 30px; padding: 0 12px;
  background: transparent; border: 1px solid var(--border);
  border-radius: 100px; font-family: inherit;
  font-size: 11.5px; font-weight: 600; color: var(--text2);
  cursor: pointer; transition: all .15s; white-space: nowrap;
}
.sort-btn:hover { border-color: var(--accent); color: var(--accent); }
.sort-btn.active { background: var(--accent); border-color: var(--accent); color: white; box-shadow: 0 2px 8px rgba(79,123,255,.25); }

/* FRESHNESS */
.fresh-bar {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px;
  background: linear-gradient(90deg, rgba(79,123,255,0.06), rgba(79,123,255,0.02));
  border: 1px solid rgba(79,123,255,0.15);
  border-radius: var(--r2); margin-bottom: 14px;
  font-size: 12px; font-weight: 600; color: var(--accent2);
}
.fresh-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 2s infinite; flex-shrink: 0; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }
.fresh-bar span.sep { color: var(--text3); }
.price-alert-btn {
  margin-left: auto;
  height: 24px; padding: 0 10px;
  background: rgba(79,123,255,.12); border: 1px solid rgba(79,123,255,.2);
  border-radius: 100px; font-family: inherit; font-size: 11px; font-weight: 700;
  color: var(--accent); cursor: pointer; transition: all .15s;
}
.price-alert-btn:hover { background: rgba(79,123,255,.22); }

/* ‚îÄ CARDS ‚îÄ */
.cards-list { display: flex; flex-direction: column; gap: 10px; }

.pcard {
  background: var(--bg1);
  border: 1px solid var(--border);
  border-radius: var(--r3);
  padding: 16px 18px;
  display: flex; align-items: center; gap: 14px;
  box-shadow: var(--shadow);
  transition: box-shadow .2s, border-color .2s, transform .15s;
  cursor: pointer; position: relative; overflow: hidden;
}
.pcard::before {
  content: '';
  position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
  background: transparent;
  transition: background .2s;
  border-radius: 2px 0 0 2px;
}
.pcard:hover { box-shadow: var(--shadow2); border-color: rgba(79,123,255,.25); transform: translateY(-1px); }
.pcard:hover::before { background: var(--accent); }
.pcard.best::before { background: var(--green); }
.pcard.best { border-color: rgba(34,197,94,.15); }

.thumb {
  width: 64px; height: 64px; flex-shrink: 0;
  border-radius: 12px; overflow: hidden;
  background: var(--bg2); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 28px; position: relative;
}
.thumb img { width: 100%; height: 100%; object-fit: contain; }
.best-badge {
  position: absolute; top: -1px; right: -1px;
  background: var(--green); color: white;
  font-size: 8px; font-weight: 800; padding: 2px 5px;
  border-radius: 0 0 0 6px; letter-spacing: .3px;
}

.card-body { flex: 1; min-width: 0; }
.card-name {
  font-size: 14.5px; font-weight: 700; color: var(--text);
  letter-spacing: -0.2px; margin-bottom: 4px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.card-sub {
  font-size: 11.5px; color: var(--text2); font-weight: 500;
  margin-bottom: 7px; display: flex; align-items: center; gap: 8px;
}
.card-sub .rating { display: flex; align-items: center; gap: 3px; }
.card-sub .stars-s { color: var(--orange); font-size: 10px; letter-spacing: -1px; }
.card-sub .rv { font-family: 'DM Mono', monospace; font-size: 11px; }
.card-tags { display: flex; gap: 5px; flex-wrap: wrap; }
.tag {
  height: 18px; padding: 0 8px; border-radius: 100px;
  font-size: 10px; font-weight: 700; display: flex; align-items: center;
  letter-spacing: .2px; white-space: nowrap;
}
.tg { background: var(--green-bg); color: var(--green); }
.to { background: var(--orange-bg); color: var(--orange); }
.tb { background: var(--accent-glow); color: var(--accent2); }
.tr { background: var(--red-bg); color: var(--red); }

.card-right { display: flex; flex-direction: column; align-items: flex-end; gap: 10px; flex-shrink: 0; min-width: 140px; }
.price-block {}
.price-main { font-size: 22px; font-weight: 800; color: var(--accent); letter-spacing: -0.5px; line-height: 1; }
.price-old { font-size: 12px; color: var(--text3); text-decoration: line-through; font-family: 'DM Mono', monospace; margin-top: 2px; }
.price-diff { font-size: 10px; color: var(--green); font-weight: 700; }
.card-btns { display: flex; gap: 5px; align-items: center; }
.btn-go {
  height: 30px; padding: 0 14px;
  background: var(--accent); color: white; border: none;
  border-radius: var(--r2); font-family: inherit; font-size: 12px; font-weight: 700;
  cursor: pointer; transition: background .15s; white-space: nowrap;
  box-shadow: 0 2px 8px rgba(79,123,255,.25);
}
.btn-go:hover { background: var(--accent2); }
.btn-out {
  height: 30px; padding: 0 12px;
  background: transparent; border: 1px solid var(--border);
  border-radius: var(--r2); font-family: inherit; font-size: 12px; font-weight: 700;
  color: var(--text2); cursor: pointer; transition: all .15s; white-space: nowrap;
}
.btn-out:hover { border-color: var(--accent); color: var(--accent); }
.fav {
  width: 30px; height: 30px; background: transparent;
  border: 1px solid var(--border); border-radius: var(--r2);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 13px; color: var(--text3); transition: all .15s;
}
.fav:hover, .fav.on { border-color: var(--red); color: var(--red); background: var(--red-bg); }

/* PRICE HISTORY SPARKLINE */
.sparkline { width: 60px; height: 20px; }

/* COMPARE DRAWER */
.compare-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--bg1); border-top: 1px solid var(--border);
  padding: 12px 28px;
  display: none; align-items: center; gap: 16px;
  z-index: 300; box-shadow: 0 -8px 32px rgba(0,0,0,.4);
  transform: translateY(100%);
  transition: transform .3s cubic-bezier(.4,0,.2,1);
}
.compare-bar.visible { display: flex; transform: translateY(0); }
.compare-items { display: flex; gap: 10px; flex: 1; }
.cmp-slot {
  width: 160px; height: 48px;
  border: 1.5px dashed var(--border);
  border-radius: var(--r2); display: flex; align-items: center;
  justify-content: center; font-size: 11px; color: var(--text3); font-weight: 600;
}
.cmp-slot.filled { border-style: solid; border-color: var(--accent); background: var(--accent-glow2); }
.cmp-action { height: 40px; padding: 0 24px; background: var(--accent); color: white; border: none; border-radius: var(--r2); font-family: inherit; font-size: 13px; font-weight: 700; cursor: pointer; }
.cmp-close { width: 32px; height: 32px; background: transparent; border: 1px solid var(--border); border-radius: var(--r2); cursor: pointer; color: var(--text2); font-size: 16px; display: flex; align-items: center; justify-content: center; }

/* ‚îÄ MAP VIEW ‚îÄ */
.map-view { display: none; }
.map-view.active { display: block; }
.map-container {
  background: var(--bg1);
  border: 1px solid var(--border);
  border-radius: var(--r3);
  overflow: hidden;
  height: 520px;
  position: relative;
}
.map-svg-wrap { width: 100%; height: 100%; position: relative; }

/* Store list panel */
.map-panel {
  position: absolute; right: 0; top: 0; bottom: 0;
  width: 280px;
  background: rgba(8,12,20,0.92);
  backdrop-filter: blur(12px);
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column;
  z-index: 10;
}
[data-theme="light"] .map-panel { background: rgba(240,244,255,0.92); }
.map-panel-header { padding: 14px 16px; border-bottom: 1px solid var(--border); font-size: 13px; font-weight: 700; }
.map-panel-header span { color: var(--text2); font-weight: 500; margin-left: 6px; font-size: 12px; }
.store-list { flex: 1; overflow-y: auto; padding: 8px; }
.store-item {
  padding: 10px 12px;
  border-radius: var(--r2);
  cursor: pointer; transition: all .15s; margin-bottom: 4px;
  border: 1px solid transparent;
}
.store-item:hover { background: var(--bg2); border-color: var(--border); }
.store-item.active { background: var(--accent-glow); border-color: rgba(79,123,255,.25); }
.store-item-name { font-size: 13px; font-weight: 700; color: var(--text); }
.store-item-sub { font-size: 11px; color: var(--text2); margin-top: 2px; }
.store-item-sub span { color: var(--green); font-weight: 600; }
.store-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; vertical-align: middle; }

/* SVG MAP */
.tbilisi-map {
  width: 100%; height: 100%;
}
.map-pin {
  cursor: pointer;
  transition: all .2s;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.4));
}
.map-pin:hover { transform: scale(1.15); filter: drop-shadow(0 4px 10px rgba(79,123,255,.5)); }
.map-pin.active { filter: drop-shadow(0 0 12px rgba(79,123,255,.8)); }

/* ‚îÄ AI DOCK ‚îÄ */
.ai-dock {
  overflow: hidden;
  opacity: 0; transform: translateX(10px);
  transition: opacity .3s, transform .3s;
  pointer-events: none;
}
.a-open .ai-dock, .fa-open .ai-dock {
  opacity: 1; transform: none; pointer-events: all;
}
.ai-inner {
  background: var(--bg1);
  border: 1px solid var(--border);
  border-radius: var(--r3);
  box-shadow: var(--shadow2);
  position: sticky; top: 108px;
  display: flex; flex-direction: column;
  min-width: 348px;
  max-height: calc(100vh - 132px);
  overflow: hidden;
}

/* LUMEN header */
.lumen-header {
  padding: 16px 18px 12px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, rgba(79,123,255,0.06), rgba(124,159,255,0.03));
  display: flex; align-items: center; gap: 12px;
}
.lumen-orb {
  width: 38px; height: 38px; border-radius: 50%; flex-shrink: 0;
  background: conic-gradient(from 0deg, #4F7BFF, #7C9FFF, #818CF8, #4F7BFF);
  display: flex; align-items: center; justify-content: center;
  animation: orb-spin 8s linear infinite;
  box-shadow: 0 0 20px rgba(79,123,255,.35), 0 0 40px rgba(79,123,255,.15);
  position: relative;
}
.lumen-orb::before {
  content: '';
  position: absolute; inset: 3px; border-radius: 50%;
  background: var(--bg1);
}
.lumen-orb::after {
  content: 'L';
  position: absolute; font-size: 14px; font-weight: 900; color: var(--accent);
  z-index: 1; letter-spacing: -1px;
}
@keyframes orb-spin {
  from { filter: hue-rotate(0deg); }
  to { filter: hue-rotate(360deg); }
}
.lumen-info {}
.lumen-name { font-size: 15px; font-weight: 900; letter-spacing: -0.3px; }
.lumen-name span { color: var(--accent); }
.lumen-status { font-size: 11px; color: var(--text3); font-weight: 500; display: flex; align-items: center; gap: 5px; margin-top: 2px; }
.lumen-status-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--green); animation: blink 2s infinite; }
.lumen-close { margin-left: auto; width: 28px; height: 28px; background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; color: var(--text2); font-size: 14px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.lumen-close:hover { color: var(--text); }

/* LUMEN insights */
.lumen-insight {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(90deg, rgba(79,123,255,0.05), transparent);
  display: flex; align-items: flex-start; gap: 8px;
}
.insight-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }
.insight-text { font-size: 12px; color: var(--text2); line-height: 1.5; font-weight: 500; }
.insight-text strong { color: var(--accent2); }

/* Quick prompts */
.quick-wrap { padding: 10px 12px; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 5px; }
.qbtn {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 11px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--r2); font-family: inherit; font-size: 12px; font-weight: 600;
  color: var(--text2); cursor: pointer; transition: all .15s; text-align: left;
}
.qbtn:hover { border-color: var(--accent); color: var(--text); background: var(--accent-glow2); }
.qbtn-ico { width: 22px; height: 22px; border-radius: 6px; background: var(--bg3); display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; }

/* Chat */
.chat-msgs {
  flex: 1; overflow-y: auto; padding: 12px;
  display: flex; flex-direction: column; gap: 10px;
  scrollbar-width: thin; scrollbar-color: var(--border) transparent;
}
.msg { display: flex; gap: 8px; animation: msg-in .25s ease; }
.msg.u { flex-direction: row-reverse; }
@keyframes msg-in { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }

.msg-av {
  width: 26px; height: 26px; border-radius: 50%;
  background: var(--bg3); border: 1px solid var(--border);
  flex-shrink: 0; display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700;
}
.msg.u .msg-av { background: linear-gradient(135deg, var(--accent), #818CF8); color: white; border: none; }
.msg-bub {
  max-width: 82%; padding: 9px 12px;
  border-radius: var(--r3); font-size: 13px; line-height: 1.55; font-weight: 500;
}
.msg.ai .msg-bub {
  background: var(--bg2); border: 1px solid var(--border); color: var(--text);
  border-bottom-left-radius: 4px;
}
.msg.u .msg-bub { background: var(--accent); color: white; border-bottom-right-radius: 4px; }
.msg-bub .accent { color: var(--accent2); font-weight: 700; }
.msg-bub .price-h { font-family: 'DM Mono', monospace; font-weight: 700; color: var(--green); }
.msg-time { font-size: 10px; color: var(--text3); margin-top: 4px; display: block; }
.msg.u .msg-time { text-align: right; }

/* Typing */
.dots { display: flex; gap: 3px; align-items: center; padding: 1px 0; }
.dots span { width: 5px; height: 5px; border-radius: 50%; background: var(--text3); animation: bounce 1.2s infinite; }
.dots span:nth-child(2) { animation-delay: .2s; }
.dots span:nth-child(3) { animation-delay: .4s; }
@keyframes bounce { 0%,60%,100%{opacity:.3;transform:none} 30%{opacity:1;transform:translateY(-3px)} }

/* LUMEN input */
.chat-input-row {
  padding: 10px 12px; border-top: 1px solid var(--border);
  display: flex; gap: 8px; align-items: center;
  background: var(--bg1);
}
.chat-inp {
  flex: 1; height: 36px; background: var(--bg2);
  border: 1.5px solid var(--border); border-radius: var(--r2);
  padding: 0 12px; font-family: inherit; font-size: 13px; font-weight: 500;
  color: var(--text); outline: none; transition: all .15s;
}
.chat-inp::placeholder { color: var(--text3); font-weight: 400; }
.chat-inp:focus { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
.send-btn {
  width: 36px; height: 36px; background: var(--accent); border: none;
  border-radius: var(--r2); cursor: pointer; color: white;
  display: flex; align-items: center; justify-content: center;
  transition: background .15s, transform .1s;
  box-shadow: 0 2px 8px rgba(79,123,255,.3);
}
.send-btn:hover { background: var(--accent2); }
.send-btn:active { transform: scale(.95); }

/* ‚îÄ LUMEN FAB ‚îÄ */
.lumen-fab {
  position: fixed; bottom: 24px; right: 24px; z-index: 201;
  width: 54px; height: 54px; border-radius: 50%;
  background: conic-gradient(from 0deg, #4F7BFF, #7C9FFF, #818CF8, #4F7BFF);
  border: none; cursor: pointer; color: white;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 8px 28px rgba(79,123,255,.45), 0 0 0 1px rgba(79,123,255,.3);
  animation: fab-pulse 3s ease-in-out infinite, fab-spin 12s linear infinite;
  transition: transform .2s, box-shadow .2s;
}
.lumen-fab::before {
  content: ''; position: absolute; inset: 3px; border-radius: 50%;
  background: var(--bg);
}
.lumen-fab .fab-l { position: relative; z-index: 1; font-size: 18px; font-weight: 900; color: var(--accent); letter-spacing: -1px; }
@keyframes fab-pulse { 0%,100%{ box-shadow: 0 8px 28px rgba(79,123,255,.45), 0 0 0 1px rgba(79,123,255,.3); } 50%{ box-shadow: 0 8px 36px rgba(79,123,255,.65), 0 0 0 6px rgba(79,123,255,.1); } }
@keyframes fab-spin { from{ filter: hue-rotate(0deg); } to{ filter: hue-rotate(360deg); } }
.lumen-fab:hover { transform: scale(1.08); }
.lumen-fab.open { animation: fab-spin 12s linear infinite; }
.fab-label {
  position: absolute; right: 62px; top: 50%; transform: translateY(-50%);
  background: var(--bg1); border: 1px solid var(--border);
  padding: 5px 12px; border-radius: var(--r2);
  font-size: 12px; font-weight: 700; white-space: nowrap;
  box-shadow: var(--shadow);
  opacity: 0; pointer-events: none; transition: opacity .2s;
}
.lumen-fab:hover .fab-label { opacity: 1; }

/* ‚îÄ PRICE HISTORY MODAL ‚îÄ */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,.7);
  backdrop-filter: blur(4px); z-index: 500;
  display: none; align-items: center; justify-content: center;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--bg1); border: 1px solid var(--border);
  border-radius: var(--r3); padding: 28px; max-width: 480px; width: 90%;
  box-shadow: var(--shadow2); animation: modal-in .2s ease;
}
@keyframes modal-in { from{opacity:0;transform:scale(.96)} to{opacity:1;transform:none} }
.modal-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 20px; }
.modal-title { font-size: 17px; font-weight: 800; letter-spacing: -0.3px; }
.modal-sub { font-size: 12px; color: var(--text2); margin-top: 3px; }
.modal-close { width: 30px; height: 30px; background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; color: var(--text2); font-size: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.chart-area { height: 140px; position: relative; margin-bottom: 16px; }
.chart-canvas { width: 100%; height: 100%; }
.price-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.stat-box { background: var(--bg2); border: 1px solid var(--border); border-radius: var(--r2); padding: 12px; text-align: center; }
.stat-val { font-size: 18px; font-weight: 800; color: var(--accent); font-family: 'DM Mono', monospace; }
.stat-lbl { font-size: 10px; color: var(--text3); font-weight: 600; margin-top: 3px; text-transform: uppercase; letter-spacing: .5px; }

/* ALERT toggle */
.alert-row { display: flex; align-items: center; justify-content: space-between; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
.alert-label { font-size: 13px; font-weight: 600; }
.alert-sub { font-size: 11px; color: var(--text2); margin-top: 2px; }

/* LIST / GRID VIEW TOGGLE */
.grid-view .cards-list { display: grid; grid-template-columns: repeat(2, 1fr); }
.grid-view .pcard { flex-direction: column; align-items: flex-start; }
.grid-view .card-right { width: 100%; flex-direction: row; align-items: center; justify-content: space-between; }
.grid-view .price-main { font-size: 18px; }

/* ‚îÄ SCROLLBAR ‚îÄ */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
</style>
</head>
<body>

<!-- Ambient -->
<div class="ambient ambient-1"></div>
<div class="ambient ambient-2"></div>

<!-- ‚îÄ HEADER ‚îÄ -->
<header>
  <div class="header-row1">
    <a class="logo" href="#">
      <div class="logo-mark"></div>
      <span class="logo-text">tbilisi<em>price</em></span>
    </a>

    <div class="search-box">
      <svg class="search-ico" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <input class="search-input" type="text" placeholder="–ü–æ–∏—Å–∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏: Samsung Galaxy S24, MacBook Air M3, AirPods‚Ä¶" id="searchInput">
      <div class="search-badge"><span class="kbd">‚åò</span><span class="kbd">K</span></div>
    </div>

    <div class="h-actions">
      <button class="h-btn" id="themeBtn" title="–¢–µ–º–∞">
        <svg id="sunIco" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg id="moonIco" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
      </button>
      <button class="h-btn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <div class="badge">3</div>
      </button>
      <button class="h-btn" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
      </button>
      <div class="avatar">KG</div>
    </div>
  </div>

  <div class="nav-chips">
    <button class="chip active" onclick="setChip(this)">–í—Å—ë</button>
    <button class="chip" onclick="setChip(this)">üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</button>
    <button class="chip" onclick="setChip(this)">üíª –ù–æ—É—Ç–±—É–∫–∏</button>
    <button class="chip" onclick="setChip(this)">üéß –ê—É–¥–∏–æ</button>
    <button class="chip" onclick="setChip(this)">‚åö –°–º–∞—Ä—Ç-—á–∞—Å—ã</button>
    <button class="chip" onclick="setChip(this)">üì∑ –ö–∞–º–µ—Ä—ã</button>
    <button class="chip" onclick="setChip(this)">üñ• –ú–æ–Ω–∏—Ç–æ—Ä—ã</button>
    <button class="chip" onclick="setChip(this)">üéÆ –ò–≥—Ä—ã</button>
  </div>
</header>

<!-- ‚îÄ LAYOUT ‚îÄ -->
<div class="layout" id="layout">

  <!-- FILTERS -->
  <aside class="sidebar">
    <div class="sidebar-card">
      <div class="slab">–§–∏–ª—å—Ç—Ä—ã</div>

      <div class="fgroup">
        <span class="flabel">–¶–µ–Ω–∞ (‚Çæ)</span>
        <div class="range-row">
          <span>–æ—Ç <span class="range-val" id="pMin">0</span></span>
          <span>–¥–æ <span class="range-val" id="pMax">5 000</span></span>
        </div>
        <input type="range" min="0" max="10000" value="5000" oninput="document.getElementById('pMax').textContent = (+this.value).toLocaleString()">
      </div>

      <div class="fgroup">
        <span class="flabel">–ë—Ä–µ–Ω–¥</span>
        <div class="brand-grid">
          <div class="brand-item on" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">Apple</span></div>
          <div class="brand-item on" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">Samsung</span></div>
          <div class="brand-item" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">Sony</span></div>
          <div class="brand-item" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">Xiaomi</span></div>
          <div class="brand-item" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">ASUS</span></div>
          <div class="brand-item" onclick="this.classList.toggle('on')"><div class="brand-cb"></div><span class="brand-name">LG</span></div>
        </div>
      </div>

      <div class="fgroup">
        <span class="flabel">–†–µ–π—Ç–∏–Ω–≥</span>
        <div class="stars-sel">
          <button class="star-btn" onclick="setStar(1)">‚òÖ</button>
          <button class="star-btn" onclick="setStar(2)">‚òÖ</button>
          <button class="star-btn on" onclick="setStar(3)">‚òÖ</button>
          <button class="star-btn on" onclick="setStar(4)">‚òÖ</button>
          <button class="star-btn on" onclick="setStar(5)">‚òÖ</button>
        </div>
      </div>

      <div class="fgroup" style="margin-bottom:0">
        <span class="flabel">–ù–∞–ª–∏—á–∏–µ</span>
        <div class="tog-row"><span>–í –Ω–∞–ª–∏—á–∏–∏</span><button class="tog on" onclick="this.classList.toggle('on')"></button></div>
        <div class="tog-row"><span>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</span><button class="tog" onclick="this.classList.toggle('on')"></button></div>
        <div class="tog-row"><span>–ì–∞—Ä–∞–Ω—Ç–∏—è 2+ –≥–æ–¥–∞</span><button class="tog" onclick="this.classList.toggle('on')"></button></div>
        <div class="tog-row"><span>–†–∞—Å—Å—Ä–æ—á–∫–∞</span><button class="tog on" onclick="this.classList.toggle('on')"></button></div>
      </div>

      <div class="apply-row">
        <button class="btn-fill">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="btn-ghost">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </aside>

  <!-- CONTENT -->
  <main class="content" id="content">
    <div class="toolbar">
      <div class="title-row">
        <span class="page-title">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</span>
        <span class="count-pill">142</span>
        <button class="filter-btn" id="filterBtn" onclick="toggleFilters()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="4" y1="6" x2="20" y2="6"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="11" y1="18" x2="13" y2="18"/></svg>
          –§–∏–ª—å—Ç—Ä—ã
        </button>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="view-tabs">
          <button class="vtab active" onclick="setView('list',this)">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            –°–ø–∏—Å–æ–∫
          </button>
          <button class="vtab" onclick="setView('map',this)">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
            –ö–∞—Ä—Ç–∞
          </button>
        </div>
        <div class="sort-row">
          <button class="sort-btn active" onclick="setSort(this)">–î–µ—à–µ–≤–ª–µ</button>
          <button class="sort-btn" onclick="setSort(this)">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</button>
          <button class="sort-btn" onclick="setSort(this)">–†–µ–π—Ç–∏–Ω–≥</button>
          <button class="sort-btn" onclick="setSort(this)">–ù–æ–≤–∏–Ω–∫–∏</button>
        </div>
      </div>
    </div>

    <div class="fresh-bar">
      <div class="fresh-dot"></div>
      –¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã <strong>2 –º–∏–Ω –Ω–∞–∑–∞–¥</strong>
      <span class="sep">¬∑</span>
      <span>12 –º–∞–≥–∞–∑–∏–Ω–æ–≤ –¢–±–∏–ª–∏—Å–∏</span>
      <span class="sep">¬∑</span>
      <span style="color:var(--green)">‚Üì 3 —Å–Ω–∏–∂–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è</span>
      <button class="price-alert-btn" onclick="openModal()">üîî –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ü–µ–Ω—É</button>
    </div>

    <!-- LIST VIEW -->
    <div id="listView">
      <div class="cards-list" id="cardsList">

        <!-- iPhone 15 Pro -->
        <div class="pcard best">
          <div class="thumb">
            üì±
            <div class="best-badge">–õ–£–ß–®–ê–Ø –¶–ï–ù–ê</div>
          </div>
          <div class="card-body">
            <div class="card-name">Apple iPhone 15 Pro, 256GB, Natural Titanium</div>
            <div class="card-sub">
              <span>iSpace ¬∑ –†—É—Å—Ç–∞–≤–µ–ª–∏</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rv">4.9</span>
                <span style="color:var(--text3)">(1.2k)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tb">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π</span>
              <span class="tag to">–†–∞—Å—Å—Ä–æ—á–∫–∞ 0%</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">3 249 ‚Çæ</div>
              <div class="price-old">3 499 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí250 ‚Çæ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'iPhone 15 Pro 256GB')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- Samsung S24 Ultra -->
        <div class="pcard">
          <div class="thumb">üì±</div>
          <div class="card-body">
            <div class="card-name">Samsung Galaxy S24 Ultra, 256GB, Titanium Black</div>
            <div class="card-sub">
              <span>Elit Electronics ¬∑ –î–∏–¥—É–±–µ</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rv">4.8</span>
                <span style="color:var(--text3)">(847)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tb">S Pen –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ</span>
              <span class="tag to">–†–∞—Å—Å—Ä–æ—á–∫–∞ 12 –º–µ—Å</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">3 490 ‚Çæ</div>
              <div class="price-old">3 699 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí209 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'Galaxy S24 Ultra')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- MacBook Air M3 -->
        <div class="pcard">
          <div class="thumb">üíª</div>
          <div class="card-body">
            <div class="card-name">Apple MacBook Air 13‚Ä≥ M3, 8GB/256GB, Midnight</div>
            <div class="card-sub">
              <span>iSpace ¬∑ –í–µ—Ä–∞</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rv">5.0</span>
                <span style="color:var(--text3)">(203)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tb">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Apple</span>
              <span class="tag to">–†–∞—Å—Å—Ä–æ—á–∫–∞ 0%</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">4 190 ‚Çæ</div>
              <div class="price-old">4 399 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí209 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'MacBook Air M3')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- Sony WH-1000XM5 -->
        <div class="pcard">
          <div class="thumb">üéß</div>
          <div class="card-body">
            <div class="card-name">Sony WH-1000XM5, Wireless Noise Cancelling, Black</div>
            <div class="card-sub">
              <span>Alto ¬∑ –°–∞–±—É—Ä—Ç–∞–ª–æ</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rv">4.9</span>
                <span style="color:var(--text3)">(634)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tb">30—á –±–∞—Ç–∞—Ä–µ—è</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">899 ‚Çæ</div>
              <div class="price-old">1 099 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí200 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'Sony WH-1000XM5')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- AirPods Pro 2 -->
        <div class="pcard">
          <div class="thumb">üéß</div>
          <div class="card-body">
            <div class="card-name">Apple AirPods Pro 2nd Gen, USB-C, MagSafe Case</div>
            <div class="card-sub">
              <span>iSpace ¬∑ –†—É—Å—Ç–∞–≤–µ–ª–∏</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rv">4.8</span>
                <span style="color:var(--text3)">(1.5k)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tb">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">649 ‚Çæ</div>
              <div class="price-old">699 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí50 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'AirPods Pro 2')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- Apple Watch Series 9 -->
        <div class="pcard">
          <div class="thumb">‚åö</div>
          <div class="card-body">
            <div class="card-name">Apple Watch Series 9, 45mm, GPS, Midnight Aluminium</div>
            <div class="card-sub">
              <span>iSpace ¬∑ –î–∏–¥—É–±–µ –ú–æ–ª–ª</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                <span class="rv">4.6</span>
                <span style="color:var(--text3)">(428)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag to">–†–∞—Å—Å—Ä–æ—á–∫–∞</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">1 149 ‚Çæ</div>
              <div class="price-old">1 249 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí100 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'Watch S9 45mm')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

        <!-- Samsung Galaxy Tab S9 -->
        <div class="pcard">
          <div class="thumb">üì±</div>
          <div class="card-body">
            <div class="card-name">Samsung Galaxy Tab S9 FE, 10.9‚Ä≥, 128GB, Lavender</div>
            <div class="card-sub">
              <span>Elit Electronics ¬∑ –ì–ª–¥–∞–Ω–∏ –ú–æ–ª–ª</span>
              <div class="rating">
                <span class="stars-s">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                <span class="rv">4.4</span>
                <span style="color:var(--text3)">(211)</span>
              </div>
            </div>
            <div class="card-tags">
              <span class="tag tg">–í –Ω–∞–ª–∏—á–∏–∏</span>
              <span class="tag tr">–û—Å—Ç–∞–ª–æ—Å—å 2 —à—Ç</span>
            </div>
          </div>
          <div class="card-right">
            <div class="price-block">
              <div class="price-main">849 ‚Çæ</div>
              <div class="price-old">999 ‚Çæ</div>
              <div class="price-diff">‚Üì ‚àí150 ‚Çæ</div>
            </div>
            <div class="card-btns">
              <button class="btn-go">–í –º–∞–≥–∞–∑–∏–Ω</button>
              <button class="btn-out" onclick="event.stopPropagation();openModal()">–ì—Ä–∞—Ñ–∏–∫</button>
              <button class="btn-out" onclick="event.stopPropagation();addCompare(this,'Galaxy Tab S9 FE')">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
              <button class="fav" onclick="event.stopPropagation();this.classList.toggle('on')">‚ô•</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- MAP VIEW -->
    <div id="mapView" class="map-view">
      <div class="map-container">
        <div class="map-panel">
          <div class="map-panel-header">–ú–∞–≥–∞–∑–∏–Ω—ã <span id="storeCount">12 –º–∞–≥–∞–∑–∏–Ω–æ–≤</span></div>
          <div class="store-list" id="storeList"></div>
        </div>
        <svg class="tbilisi-map" id="tbilisiMap" viewBox="0 0 720 520">
          <!-- Tbilisi simplified map background -->
          <defs>
            <linearGradient id="mapGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#0D1320"/>
              <stop offset="100%" style="stop-color:#111827"/>
            </linearGradient>
            <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          </defs>
          
          <!-- Map base -->
          <rect width="720" height="520" fill="url(#mapGrad)"/>
          
          <!-- Grid lines -->
          <g stroke="rgba(255,255,255,0.03)" stroke-width="1">
            <line x1="0" y1="130" x2="720" y2="130"/>
            <line x1="0" y1="260" x2="720" y2="260"/>
            <line x1="0" y1="390" x2="720" y2="390"/>
            <line x1="180" y1="0" x2="180" y2="520"/>
            <line x1="360" y1="0" x2="360" y2="520"/>
            <line x1="540" y1="0" x2="540" y2="520"/>
          </g>
          
          <!-- Mtkvari river -->
          <path d="M0 280 Q80 260 140 270 Q200 280 240 265 Q290 250 340 260 Q390 270 440 255 Q490 240 540 250 Q600 260 650 248 Q680 242 720 245" 
                stroke="#1E4A7A" stroke-width="16" fill="none" opacity=".7"/>
          <path d="M0 280 Q80 260 140 270 Q200 280 240 265 Q290 250 340 260 Q390 270 440 255 Q490 240 540 250 Q600 260 650 248 Q680 242 720 245" 
                stroke="#2563EB" stroke-width="4" fill="none" opacity=".2"/>
          
          <!-- Streets (simplified) -->
          <g stroke="rgba(255,255,255,0.06)" stroke-width="1.5" fill="none">
            <!-- Rustaveli Ave -->
            <line x1="180" y1="240" x2="480" y2="240"/>
            <!-- Aghmashebeli -->
            <line x1="120" y1="200" x2="420" y2="290"/>
            <!-- Cross streets -->
            <line x1="280" y1="150" x2="280" y2="380"/>
            <line x1="380" y1="160" x2="380" y2="370"/>
            <line x1="180" y1="150" x2="180" y2="400"/>
            <line x1="480" y1="140" x2="480" y2="380"/>
            <line x1="100" y1="300" x2="620" y2="300"/>
            <line x1="100" y1="350" x2="580" y2="350"/>
            <line x1="140" y1="180" x2="600" y2="200"/>
          </g>
          
          <!-- Districts labels -->
          <g font-family="DM Sans, sans-serif" font-size="10" fill="rgba(255,255,255,0.15)" font-weight="600" letter-spacing="1">
            <text x="60" y="220">–°–ê–ë–£–†–¢–ê–õ–û</text>
            <text x="280" y="200">–¶–ï–ù–¢–†</text>
            <text x="480" y="185">–ò–°–ê–ù–ò</text>
            <text x="70" y="380">–ì–õ–î–ê–ù–ò</text>
            <text x="270" y="400">–î–ò–î–£–ë–ï</text>
            <text x="490" y="390">–í–ê–†–ö–ï–¢–ò–õ–ò</text>
          </g>
          
          <!-- Store pins will be injected by JS -->
          <g id="pinGroup"></g>
        </svg>
      </div>
    </div>
  </main>

  <!-- AI DOCK -->
  <aside class="ai-dock">
    <div class="ai-inner">
      <div class="lumen-header">
        <div class="lumen-orb"></div>
        <div class="lumen-info">
          <div class="lumen-name"><span>LUMEN</span></div>
          <div class="lumen-status">
            <div class="lumen-status-dot"></div>
            –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é 142 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
          </div>
        </div>
        <button class="lumen-close" onclick="toggleAI()">√ó</button>
      </div>

      <div class="lumen-insight">
        <span class="insight-icon">üí°</span>
        <div class="insight-text">iPhone 15 Pro —Å–µ–π—á–∞—Å –Ω–∞ <strong>‚àí250‚Çæ –Ω–∏–∂–µ</strong> —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –≥–æ—Ä–æ–¥—É. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º –≤ iSpace –¥–æ—Å—Ç–∏–≥–Ω—É—Ç 3 –¥–Ω—è –Ω–∞–∑–∞–¥.</div>
      </div>

      <div class="quick-wrap">
        <button class="qbtn" onclick="quickAsk('–ù–∞–π–¥–∏ —Å–∞–º—ã–π –¥–µ—à—ë–≤—ã–π iPhone 15 –≤ –¢–±–∏–ª–∏—Å–∏')"><div class="qbtn-ico">üìç</div>–°–∞–º—ã–π –¥–µ—à—ë–≤—ã–π iPhone 15</button>
        <button class="qbtn" onclick="quickAsk('–°—Ä–∞–≤–Ω–∏ Samsung S24 Ultra –∏ iPhone 15 Pro Max –ø–æ —Ü–µ–Ω–µ')"><div class="qbtn-ico">‚öñÔ∏è</div>S24 Ultra vs iPhone 15 Pro</button>
        <button class="qbtn" onclick="quickAsk('–ì–¥–µ –∫—É–ø–∏—Ç—å MacBook Air M3 —Å —Ä–∞—Å—Å—Ä–æ—á–∫–æ–π 0%?')"><div class="qbtn-ico">üí≥</div>MacBook –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É 0%</button>
        <button class="qbtn" onclick="quickAsk('–ü–æ–∫–∞–∂–∏ —Ç–æ–ø-5 —Å–∫–∏–¥–æ–∫ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫—É —Å–µ–≥–æ–¥–Ω—è')"><div class="qbtn-ico">üî•</div>–¢–æ–ø —Å–∫–∏–¥–æ–∫ —Å–µ–≥–æ–¥–Ω—è</button>
      </div>

      <div class="chat-msgs" id="chatMsgs">
        <div class="msg ai">
          <div class="msg-av">L</div>
          <div>
            <div class="msg-bub">–ü—Ä–∏–≤–µ—Ç! –Ø <span class="accent">LUMEN</span> ‚Äî —Ç–≤–æ–π –ò–ò-–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ —Ü–µ–Ω–∞–º –¢–±–∏–ª–∏—Å–∏. –°–µ–π—á–∞—Å –≤–∏–∂—É <span class="price-h">3 –≤—ã–≥–æ–¥–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞</span> –¥–ª—è –ø–æ–∫—É–ø–∫–∏. –°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ –ª—é–±–æ–º —Ç–æ–≤–∞—Ä–µ!</div>
            <span class="msg-time">—Å–µ–π—á–∞—Å</span>
          </div>
        </div>
      </div>

      <div class="chat-input-row">
        <input class="chat-inp" placeholder="–°–ø—Ä–æ—Å–∏ LUMEN‚Ä¶" id="chatInput" onkeydown="if(event.key==='Enter')sendChat()">
        <button class="send-btn" onclick="sendChat()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </aside>

</div><!-- /layout -->

<!-- ‚îÄ COMPARE BAR ‚îÄ -->
<div class="compare-bar" id="compareBar">
  <div style="font-size:13px;font-weight:700;white-space:nowrap">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
  <div class="compare-items" id="compareItems">
    <div class="cmp-slot" id="cmp0">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
    <div class="cmp-slot" id="cmp1">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
    <div class="cmp-slot" id="cmp2">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
  </div>
  <button class="cmp-action">–°—Ä–∞–≤–Ω–∏—Ç—å</button>
  <button class="cmp-close" onclick="clearCompare()">√ó</button>
</div>

<!-- ‚îÄ LUMEN FAB ‚îÄ -->
<button class="lumen-fab" id="lumenFab" onclick="toggleAI()">
  <span class="fab-l">L</span>
  <span class="fab-label">LUMEN AI</span>
</button>

<!-- ‚îÄ PRICE HISTORY MODAL ‚îÄ -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title">–ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω ‚Äî iPhone 15 Pro 256GB</div>
        <div class="modal-sub">iSpace ¬∑ –†—É—Å—Ç–∞–≤–µ–ª–∏ ¬∑ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π</div>
      </div>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div class="chart-area">
      <canvas class="chart-canvas" id="priceChart" width="420" height="140"></canvas>
    </div>
    <div class="price-stats">
      <div class="stat-box"><div class="stat-val">3 249‚Çæ</div><div class="stat-lbl">–°–µ–π—á–∞—Å</div></div>
      <div class="stat-box"><div class="stat-val">3 099‚Çæ</div><div class="stat-lbl">–ú–∏–Ω–∏–º—É–º</div></div>
      <div class="stat-box"><div class="stat-val">3 599‚Çæ</div><div class="stat-lbl">–ú–∞–∫—Å–∏–º—É–º</div></div>
    </div>
    <div class="alert-row">
      <div>
        <div class="alert-label">üîî –£–≤–µ–¥–æ–º–∏—Ç—å –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏</div>
        <div class="alert-sub">–ü–æ–ª—É—á–∏ –ø—É—à, –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ —É–ø–∞–¥—ë—Ç –Ω–∏–∂–µ 3 100 ‚Çæ</div>
      </div>
      <button class="tog on" onclick="this.classList.toggle('on')"></button>
    </div>
  </div>
</div>

<script>
// ‚îÄ STORES DATA ‚îÄ
const stores = [
  { id: 1, name: 'iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏',    sub: '–ü—Ä. –†—É—Å—Ç–∞–≤–µ–ª–∏ 42',     x: 340, y: 238, color: '#4F7BFF', count: 24, rating: '4.9' },
  { id: 2, name: 'iSpace –í–µ—Ä–∞',         sub: '—É–ª. –í–∞–∂–∞-–ü—à–∞–≤–µ–ª–∞ 7',   x: 180, y: 190, color: '#4F7BFF', count: 22, rating: '4.8' },
  { id: 3, name: 'iSpace –î–∏–¥—É–±–µ –ú–æ–ª–ª',  sub: '–ú–æ–ª–ª –î–∏–¥—É–±–µ',          x: 270, y: 340, color: '#4F7BFF', count: 20, rating: '4.7' },
  { id: 4, name: 'Elit Electronics',    sub: '–°–∞–±—É—Ä—Ç–∞–ª–æ –ú–æ–ª–ª',       x: 115, y: 225, color: '#F59E0B', count: 31, rating: '4.6' },
  { id: 5, name: 'Elit Electronics',    sub: '–ì–ª–¥–∞–Ω–∏ –ú–æ–ª–ª',          x: 110, y: 370, color: '#F59E0B', count: 28, rating: '4.5' },
  { id: 6, name: 'Alto Store',          sub: '—É–ª. –ß–∞–≤—á–∞–≤–∞–¥–∑–µ 12',    x: 145, y: 160, color: '#22C55E', count: 19, rating: '4.8' },
  { id: 7, name: 'Alto Store',          sub: '–í–∞—Ä–∫–µ—Ç–∏–ª–∏ –ú–æ–ª–ª',       x: 580, y: 360, color: '#22C55E', count: 15, rating: '4.4' },
  { id: 8, name: 'Zoommer',             sub: '–ü—Ä. –ê–≥–º–∞—à–µ–Ω–µ–±–µ–ª–∏ 55',  x: 220, y: 300, color: '#A855F7', count: 42, rating: '4.3' },
  { id: 9, name: 'Zoommer',             sub: '–ò—Å–∞–Ω–∏ –ú–æ–ª–ª',           x: 490, y: 250, color: '#A855F7', count: 38, rating: '4.2' },
  { id: 10, name: 'Samsung Store',      sub: '–ü—Ä. –†—É—Å—Ç–∞–≤–µ–ª–∏ 8',      x: 310, y: 236, color: '#3B82F6', count: 16, rating: '4.7' },
  { id: 11, name: 'Sony Centre',        sub: '–¢–±–∏–ª–∏—Å–∏ –ú–æ–ª–ª',         x: 600, y: 180, color: '#EF4444', count: 12, rating: '4.6' },
  { id: 12, name: 'Xiaomi Store',       sub: '–î–∏–¥—É–±–µ –ë–∞–∑—Ä–∞—Ä–∏',       x: 255, y: 355, color: '#F97316', count: 21, rating: '4.5' },
];

let activeStore = null;

// Build store list and map pins
function buildMap() {
  const list = document.getElementById('storeList');
  const pinGroup = document.getElementById('pinGroup');
  list.innerHTML = '';
  pinGroup.innerHTML = '';

  stores.forEach(s => {
    // List item
    const item = document.createElement('div');
    item.className = 'store-item';
    item.id = `si-${s.id}`;
    item.innerHTML = `
      <div style="display:flex;align-items:center">
        <span class="store-dot" style="background:${s.color}"></span>
        <div class="store-item-name">${s.name}</div>
      </div>
      <div class="store-item-sub">${s.sub} ¬∑ <span>${s.count} —Ç–æ–≤–∞—Ä–æ–≤</span> ¬∑ ‚òÖ ${s.rating}</div>`;
    item.onclick = () => selectStore(s.id);
    list.appendChild(item);

    // Map pin
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class','map-pin');
    g.setAttribute('id',`pin-${s.id}`);
    g.setAttribute('transform',`translate(${s.x},${s.y})`);
    g.onclick = () => selectStore(s.id);
    g.innerHTML = `
      <circle r="14" fill="${s.color}" opacity=".15"/>
      <circle r="8" fill="${s.color}"/>
      <circle r="3" fill="white"/>
      <text y="-18" text-anchor="middle" font-family="DM Sans,sans-serif" font-size="9.5" font-weight="700" fill="rgba(255,255,255,0.85)">${s.name.split(' ')[0]}</text>`;
    pinGroup.appendChild(g);
  });
}

function selectStore(id) {
  document.querySelectorAll('.store-item').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.map-pin').forEach(p => p.classList.remove('active'));
  if (activeStore === id) { activeStore = null; return; }
  activeStore = id;
  document.getElementById(`si-${id}`)?.classList.add('active');
  document.getElementById(`pin-${id}`)?.classList.add('active');
}

buildMap();

// ‚îÄ VIEWS ‚îÄ
function setView(v, btn) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('listView').style.display = v === 'list' ? '' : 'none';
  document.getElementById('mapView').classList.toggle('active', v === 'map');
}

// ‚îÄ LAYOUT ‚îÄ
let filtersOpen = false, aiOpen = false;
function updateLayout() {
  const l = document.getElementById('layout');
  l.className = 'layout';
  if (filtersOpen && aiOpen) l.classList.add('fa-open');
  else if (filtersOpen) l.classList.add('f-open');
  else if (aiOpen) l.classList.add('a-open');
}

function toggleFilters() {
  filtersOpen = !filtersOpen;
  document.getElementById('filterBtn').classList.toggle('active', filtersOpen);
  updateLayout();
}

function toggleAI() {
  aiOpen = !aiOpen;
  document.getElementById('lumenFab').classList.toggle('open', aiOpen);
  updateLayout();
}

// ‚îÄ THEME ‚îÄ
let dark = true;
document.getElementById('themeBtn').onclick = () => {
  dark = !dark;
  document.documentElement.setAttribute('data-theme', dark ? 'dark' : 'light');
  document.getElementById('sunIco').style.display = dark ? 'none' : '';
  document.getElementById('moonIco').style.display = dark ? '' : 'none';
};

// ‚îÄ CHIPS / SORT ‚îÄ
function setChip(el) { document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active')); el.classList.add('active'); }
function setSort(el) { document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
function setStar(n) { document.querySelectorAll('.star-btn').forEach((b,i)=>b.classList.toggle('on',i>=5-n)); }

// ‚îÄ COMPARE ‚îÄ
let compareList = [];
function addCompare(btn, name) {
  if (compareList.includes(name)) return;
  if (compareList.length >= 3) return;
  compareList.push(name);
  const bar = document.getElementById('compareBar');
  bar.classList.add('visible');
  const slot = document.getElementById(`cmp${compareList.length-1}`);
  slot.textContent = name;
  slot.classList.add('filled');
}
function clearCompare() {
  compareList = [];
  document.getElementById('compareBar').classList.remove('visible');
  for(let i=0;i<3;i++){
    const s = document.getElementById(`cmp${i}`);
    s.textContent = '+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    s.classList.remove('filled');
  }
}

// ‚îÄ MODAL (Price History) ‚îÄ
function openModal() {
  document.getElementById('modal').classList.add('open');
  drawChart();
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }

function drawChart() {
  const canvas = document.getElementById('priceChart');
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 420, H = canvas.offsetHeight || 140;
  canvas.width = W; canvas.height = H;
  ctx.clearRect(0,0,W,H);

  const prices = [3599,3499,3499,3450,3380,3299,3249,3199,3099,3149,3249,3249,3249,3299,3249];
  const min = Math.min(...prices) - 100;
  const max = Math.max(...prices) + 100;
  const pts = prices.map((p,i)=>({ x: (i/(prices.length-1))*W, y: H - ((p-min)/(max-min))*(H-20)-10 }));

  // Area fill
  const grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0, 'rgba(79,123,255,0.25)');
  grad.addColorStop(1, 'rgba(79,123,255,0)');
  ctx.beginPath();
  ctx.moveTo(pts[0].x, H);
  pts.forEach(p => ctx.lineTo(p.x, p.y));
  ctx.lineTo(pts[pts.length-1].x, H);
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // Line
  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for(let i=1;i<pts.length;i++){
    const cx=(pts[i-1].x+pts[i].x)/2;
    ctx.bezierCurveTo(cx,pts[i-1].y,cx,pts[i].y,pts[i].x,pts[i].y);
  }
  ctx.strokeStyle = '#4F7BFF';
  ctx.lineWidth = 2.5;
  ctx.stroke();

  // Current price dot
  const last = pts[pts.length-1];
  ctx.beginPath();
  ctx.arc(last.x, last.y, 5, 0, Math.PI*2);
  ctx.fillStyle = '#4F7BFF';
  ctx.fill();
  ctx.beginPath();
  ctx.arc(last.x, last.y, 2.5, 0, Math.PI*2);
  ctx.fillStyle = 'white';
  ctx.fill();
}

// ‚îÄ LUMEN CHAT ‚îÄ
const lumenReplies = [
  (q) => `–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å <em>"${q.slice(0,30)}..."</em>...<br><br>üìç –ù–∞—à—ë–ª <strong>3 –º–∞–≥–∞–∑–∏–Ω–∞</strong> –≤ –¢–±–∏–ª–∏—Å–∏ —Å –ª—É—á—à–∏–º–∏ —Ü–µ–Ω–∞–º–∏.<br><br>üèÜ –õ—É—á—à–∞—è —Ü–µ–Ω–∞: <span class="price-h">iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏ ‚Äî 3 249‚Çæ</span><br>–≠–∫–æ–Ω–æ–º–∏—è: ‚àí250‚Çæ –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –≥–æ—Ä–æ–¥—É.`,
  () => `–°—Ä–∞–≤–Ω–µ–Ω–∏–µ Samsung S24 Ultra vs iPhone 15 Pro Max:<br><br>üì± <strong>S24 Ultra</strong> ‚Äî 3 490‚Çæ ¬∑ Android ¬∑ S Pen ¬∑ 200MP<br>üì± <strong>iPhone 15 Pro Max</strong> ‚Äî 3 899‚Çæ ¬∑ iOS ¬∑ USB-C ¬∑ 48MP<br><br>üí° –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî –∫–∞–º–µ—Ä–∞ –∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ Apple, –±–µ—Ä–∏ iPhone. –î–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî Samsung.`,
  () => `MacBook Air M3 –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É 0%:<br><br>‚úÖ <strong>iSpace –†—É—Å—Ç–∞–≤–µ–ª–∏</strong> ‚Äî 4 190‚Çæ ¬∑ 12 –º–µ—Å ¬∑ 0%<br>‚úÖ <strong>iSpace –í–µ—Ä–∞</strong> ‚Äî 4 190‚Çæ ¬∑ 6 –º–µ—Å ¬∑ 0%<br>‚úÖ <strong>Elit Electronics</strong> ‚Äî 4 290‚Çæ ¬∑ 18 –º–µ—Å ¬∑ 3%<br><br>–†–µ–∫–æ–º–µ–Ω–¥—É—é iSpace: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥–∏–ª–µ—Ä + –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å.`,
  () => `üî• –¢–æ–ø —Å–∫–∏–¥–æ–∫ —Å–µ–≥–æ–¥–Ω—è –≤ –¢–±–∏–ª–∏—Å–∏:<br><br>1. <span class="price-h">Sony WH-1000XM5</span> ‚Äî 899‚Çæ (‚àí200‚Çæ)<br>2. <span class="price-h">Samsung Tab S9 FE</span> ‚Äî 849‚Çæ (‚àí150‚Çæ)<br>3. <span class="price-h">iPhone 15 Pro</span> ‚Äî 3 249‚Çæ (‚àí250‚Çæ)<br>4. <span class="price-h">AirPods Pro 2</span> ‚Äî 649‚Çæ (‚àí50‚Çæ)<br><br>–í—Å–µ —Ü–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã 2 –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥.`,
];
let rIdx = 0;

function addMsg(text, role) {
  const msgs = document.getElementById('chatMsgs');
  const d = document.createElement('div');
  d.className = `msg ${role}`;
  d.innerHTML = `<div class="msg-av">${role==='ai'?'L':'KG'}</div><div><div class="msg-bub">${text}</div><span class="msg-time">—Å–µ–π—á–∞—Å</span></div>`;
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
}
function addTyping() {
  const msgs = document.getElementById('chatMsgs');
  const d = document.createElement('div');
  d.className = 'msg ai'; d.id = 'typing';
  d.innerHTML = `<div class="msg-av">L</div><div><div class="msg-bub"><div class="dots"><span></span><span></span><span></span></div></div></div>`;
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
}
function removeTyping() { document.getElementById('typing')?.remove(); }

function sendChat() {
  const inp = document.getElementById('chatInput');
  const txt = inp.value.trim(); if (!txt) return;
  inp.value = '';
  if (!aiOpen) { aiOpen = true; updateLayout(); }
  addMsg(txt, 'u');
  addTyping();
  setTimeout(() => {
    removeTyping();
    const reply = lumenReplies[rIdx % lumenReplies.length](txt);
    rIdx++;
    addMsg(reply, 'ai');
  }, 1400);
}

function quickAsk(q) {
  if (!aiOpen) { aiOpen = true; updateLayout(); }
  addMsg(q, 'u');
  addTyping();
  setTimeout(() => {
    removeTyping();
    const reply = lumenReplies[rIdx % lumenReplies.length](q);
    rIdx++;
    addMsg(reply, 'ai');
  }, 1400);
}
</script>
</body>
</html>
